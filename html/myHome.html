<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>个人中心</title>
    <meta content="width=device-width,target-densitydpi=device-dpi, user-scalable=0" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="true" name="HandheldFriendly"/>
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta content="模型APP内测招募" property="title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="image"/>

    <meta content="模型APP内测招募" property="og:title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="og:image"/>
    <script type="text/javascript">
        if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
            var version = parseFloat(RegExp.$1);
            if (version > 2.3) {
                var phoneScale = parseInt(window.screen.width) / 750;
                document.write('<meta name="viewport" content="width=750, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
            } else {
                document.write('<meta name="viewport" content="width=, target-densitydpi=device-dpi">');
            }
        } else {
            document.write('<meta name="viewport" content="width=750, user-scalable=no">');
        }
    </script>
    <link href="css/style.css" rel="stylesheet">
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>
    <link href="mescroll/mescroll.min.css" rel="stylesheet"></link>
    <script src="js/pinchzoom.js" type="text/javascript"></script>


    <style type="text/css">


        /*ios使用sticky样式实现*/
        .nav-sticky {
            /* height: 179px; */
            z-index: 9999; /*需设置zIndex,避免在悬停时,可能会被列表数据遮住*/
            position: -webkit-sticky;
            position: sticky;
            top: 0; /*相对mescroll的div悬停的位置*/
        }

        .nav-sticky:before #fixation_menu {
            display: block;
        }

        /*android和pc端悬停*/
        .nav-fixed {
            z-index: 9999;
            position: fixed;
            top: 0px;
            left: 0;
            width: 100%;
        }

        .nav-fixed #fixation_menu {
            display: block;
        }

        /* .nav-fixed #fixation_menu{display: block;} */
        /*列表*/
        .mescroll {
            position: fixed;
            top: 0px;
            bottom: 0;
            width: 100%;
            height: auto;
        }

        /*展示上拉加载的数据列表*/
        .data-list li {
            position: relative;
            /*padding: 10px 8px 10px 120px;*/
            border-bottom: 1px solid #eee;
        }

        .data-list .pd-img {
            position: absolute;
            left: 18px;
            top: 18px;
            width: 80px;
            height: 80px;
        }

        .data-list .pd-name {
            font-size: 16px;
            line-height: 20px;
            height: 40px;
            overflow: hidden;
        }

        .data-list .pd-price {
            margin-top: 8px;
            color: red;
        }

        .data-list .pd-sold {
            font-size: 12px;
            margin-top: 8px;
            color: gray;
        }

        .mescroll-totop {
            right: 10px;
            bottom: 240px;
        }
    </style>
</head>
<body>
<div id="myHome">
    <!-- <div class="head">
        <p class="title">个人中心</p>
        <div class="morebt"></div>
    </div> -->
    <div class="moreMenu">
        <div class="click"></div>
        <div class="box">
            <h1 class="title">更多</h1>
            <ul>
                <li onclick="window.location.href='wallet.html'"><img src="img/myhome/money.png">余额管理</li>
            </ul>
            <ul>
                <li onclick="window.location.href='myAuction.html'"><img src="img/myhome/ico1.png">我的拍卖</li>
                <!-- <li onclick="window.location.href='myFriend.html'"><img src="img/myhome/ico2.png">我的朋友</li> -->
                <li onclick="window.location.href='myDraft.html'"><img src="img/myhome/ico3.png">我的草稿</li>
                <li onclick="window.location.href='myAddr.html'"><img src="img/myhome/ico4.png">我的地址</li>

            </ul>
            <ul>
                <li onclick="window.location.href='set.html'"><img src="img/myhome/ico5.png">设置</li>
            </ul>
        </div>
    </div>

    <div class="content">
        <div class="favorite"></div>


        <div class="mescroll" id="mescroll">
            <div class="myDatum">


            </div>

            <!--
                悬浮菜单:
                1.ios的悬停效果,通过给navWarp添加sticky样式来实现
                2.android和pc端悬停效果,通过监听mescroll的scroll事件,控制navContent是否为fixed定位来实现
            -->
            <div id="navWarp">
                <div class="nav" id="navContent">
                    <ul id="sildeMenu">
                        <li class="hover" data-id="0" style="margin-left:96px">帖子</li>
                        <li data-id="1">藏品</li>
                        <li class="zanbt" data-id="2">点赞</li>
                        <li class="auctionbt" data-id="3">拍品</li>
                    </ul>
                </div>
            </div>
            <!--upscrollWarp用于装载上拉进度和数据列表,避免清空列表不满屏,导致点击悬浮菜单时会滑下来-->
            <div id="upscrollWarp">
                <!--展示上拉加载的数据列表-->
                <ul class="data-list postdetail" id="dataList">

                </ul>
            </div>
        </div>

    </div>

    <div id="foot_menu">
        <ul>
            <li onclick="window.location.href='index.html'">
                <img src="img/index/ico_menu1_1.png">
                <p>首页</p>
            </li>
            <li onclick="window.location.href='auction.html'">
                <img src="img/index/ico_menu2_1.png">
                <p>拍卖</p>
            </li>
            <li onclick="issue_show()">
                <img src="img/index/ico_menu3_1.png">
                <p>发布</p>
            </li>
            <li onclick="window.location.href='message.html'">
                <img src="img/index/ico_menu4_1.png">
                <p>消息</p>
                <div class="dot"></div>
            </li>
            <li class="hover" onclick="window.location.href='myHome.html'">
                <img src="img/index/ico_menu5_2.png">
                <p>我的</p>
            </li>
        </ul>
    </div>

    <div class="button_box">
        <button><p class="attention" data-isFollow="" data-userid="">关注</p></button>
        <button class="chatbt" onclick="privateLetterTA();">私信TA</button>
    </div>

    <!--取消关注提示框-->
    <div class="hint_box3" style="display: none;">
        <div class="click"></div>
        <div class="box">
            <!--<p class="title">您是否已收到货品？</p>-->
            <p class="text">确定要取消关注 <span>宁胡扯</span>吗？</p>
            <div class="bt">
                <button class="close">手滑了</button>
                <button class="affirm">取消关注</button>
            </div>
        </div>
    </div>


    <!--发布选项浮层-->
    <div id="issue_select">
        <div class="white"></div>
        <div class="box">
            <!-- <a href="issue_post.html" class="issue_post"><img src="img/issue/ico1.png"><span>发布帖子</span></a>
            <a href="issue_object.html?id=1" class="issue_product"><img src="img/issue/ico2.png"><span>发布藏品</span></a>
            <a href="issue_object.html?id=2" class="issue_product2"><img src="img/issue/ico3.png"><span>发布拍品</span></a> -->
            <a class="issue_post" onclick="addRecord('POSTS','1')"><img src="img/issue/ico1.png"><span>发布帖子</span></a>
            <!-- <a onclick="addRecord('TREASURE','2')"  class="issue_product"><img src="img/issue/ico2.png"><span>发布藏品</span></a> -->
            <a class="issue_product2" onclick="addRecord('AUCTION','3')"><img src="img/issue/ico3.png"><span>发布商品</span></a>
            <div class="delete" onclick="issue_close()"></div>
        </div>
    </div>

    <div class="hint_box"><p></p></div>

</div>

<script src="js/common.js" type="text/javascript"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
<!--上拉加载文件-->
<script charset="utf-8" src="mescroll/mescroll.min.js"></script>
<script type="text/javascript">
    shareMsg(); //分享
    getUnReadMsgNum('ALL');//获取未读消息

    $(".content").css({"min-height": $(window).height() - 170});
    var userId = '';
    userId = getQueryStringByName('userId');
    console.log(userId);


    //初始化获取用户信息
    getOneSocial(userId);


    function inhtml(currhtml, count) {

        let str = '';
        let signature = "";
        console.log(currhtml);
        if (currhtml.signature) {
            signature = currhtml.signature.substring(0, 14) + '...'
        } else {
            signature = "无"
        }
        console.log(count);
        if (count == 0) {
            $(".button_box").show();
            $("#foot_menu").hide();
            // $(".moreMenu .box ul:nth-child(1)").hide()
            // $(".morebt").hide();
            $("#sildeMenu .zanbt").hide();
            $("#sildeMenu .auctionbt").show();
            str += '<div class="myMsg">';
            str += '<div class="bg"><img src="' + link + currhtml.backGroundPath + '" onerror="src=\'img/myhome/bg.jpg\'"><div class="black"></div></div>';
            str += '<div class="detail" style="background:none">';
            $('title').text(currhtml.username)
        } else {
            $(".button_box").hide();
            $("#foot_menu").show();
            $("#sildeMenu .zanbt").show();
            $("#sildeMenu .auctionbt").hide();
            str += '<div class="myMsg">';
            str += '<div class="bg"><img src="' + link + currhtml.backGroundPath + '" onerror="src=\'img/myhome/bg.jpg\'"><div class="black"></div></div>';

            str += '<div class="detail">'
        }

        $(".attention").attr("data-userid", currhtml.userId);
        $(".attention").attr("data-isfollow", currhtml.isFollow);
        $(".attention").parent().addClass("user_" + currhtml.userId);
        if (currhtml.isFollow == true) {
            $(".attention").text('已关注');
            $(".attention").addClass("hover")
        }
        console.log(currhtml.avatarPath);
        str += '<div class="head_img">' + headImgHtml(currhtml.avatarPath) + '<div class="grand ' + currhtml.sex + '"></div>' +
            '</div>' +
            '<div class="msg">' +
            '<div class="name_box">';

        if (currhtml.userLevel > 0) {
            str += '<p class="name">' + userName(currhtml.username) +
                '<img class="Authentication" src="img/myhome/v_' + currhtml.userLevel + '.png"></p>'
        } else {
            str += '<p class="name">' + userName(currhtml.username) + '</p>'
        }
        str += '<p class="lable selectID"></p>';
        if (count > 0) {
            str += '<div class="bt_button"><button class="morebt"><img src="img/myhome/set.png"></button><button onclick="window.location.href=\'modifiedData.html?userId=' + currhtml.userId + '\'">编辑资料</button></div>'
        }
        str += '</div>' +
            '<p class="signature">个性签名：<span>' + signature + '<span></p>' +
            '</div>' +
            '</div>' +
            '</div>' +
            '<ul class="number_box">' +
            // '<li class="favorite"><img src="img/myhome/ico.png" alt="" /><span>收藏柜</span></li>'+
            '<li class="attentionName"><p>' + currhtml.followSum + '</p>关注</li>' +
            '<li class="fans"><p>' + currhtml.fansSum + '</p>粉丝</li>' +
            '<li class="like"><p>' + currhtml.goodSum + '</p>获赞</li>' +
            '</ul>';
        $(".myDatum").append(str);
        $(".morebt").click(function () {
            $(".moreMenu").show();
        });
        //获取用户职业标签
        getUserCareer(userId);
        plantGrass();


        $(".favorite").click(function () {
            if (userId) {
                window.location.href = 'favorite.html?userId=' + userId
            } else {
                window.location.href = 'favorite.html'
            }
        });
        $(".attentionName").click(function () {
            if (!userId)
                window.location.href = 'myFriend.html?id=0';
            else
                window.location.href = 'myFriend.html?id=0&userId=' + userId
        });
        $(".fans").click(function () {
            if (!userId)
                window.location.href = 'myFriend.html?id=1';
            else
                window.location.href = 'myFriend.html?id=1&userId=' + userId

        })
    }


    //添加或删除关注人点击事件
    function plantGrass() {
        $(".attention").click(function () {
            var isfollow = $(this).attr('data-isfollow');
            userId = $(this).data('userid');
            if (isfollow == 'false') {
                plantGrassOrCancel(userId, '0')//添加或删除关注人
            } else {
                let name = $(".myDatum .name_box .name").text();
                $(".hint_box3 .text span").text(name);
                $(".hint_box3").fadeIn(200)
            }
        });

        $(".close").click(function () {
            $(".hint_box3").fadeOut(200);
        });
        $(".affirm").click(function () {
            $(".hint_box3").fadeOut(200);
            plantGrassOrCancel(userId, '0')//添加或删除关注人
        })

    }


    var index = 0;

    $("#sildeMenu li").click(function () {
        $("#sildeMenu li").removeClass("hover");
        $(this).addClass("hover");
        index = $(this).data('id');
        var minHight = mescroll.getClientHeight() - navWarp.offsetHeight;
        document.getElementById("upscrollWarp").style.minHeight = minHight + "px";
        mescroll.resetUpScroll();
    });


    // 参数对象

    var mescroll = new MeScroll("mescroll", {
        up: {
            callback: upCallback, //上拉回调,此处可简写; 相当于 callback: function (page, mescroll) { getListData(page); }
            isBounce: false, //此处禁止ios回弹,解析(务必认真阅读,特别是最后一点): http://www.mescroll.com/qa.html#q10
            noMoreSize: 1,
            clearEmptyId: "dataList", //相当于同时设置了clearId和empty.warpId; 简化写法;默认null; 注意vue中不能配置此项
            warpId: "upscrollWarp", //让上拉进度装到upscrollWarp里面
            lazyLoad: {
                use: true // 是否开启懒加载,默认false
            },
            toTop: { //配置回到顶部按钮
                src: "../res/img/mescroll-totop.png" //默认滚动到1000px显示,可配置offset修改
            }
        }
    });


    //下拉后吸顶悬浮距离计算
    var navWarp = document.getElementById("navWarp");
    console.log(mescroll.os.ios);
    if (mescroll.os.ios) {
        //ios的悬停效果,通过给navWarp添加nav-sticky样式来实现
        navWarp.classList.add("nav-sticky");
    } else {
        //android和pc端悬停效果,通过监听mescroll的scroll事件,控制navContent是否为fixed定位来实现
        console.log(navWarp.offsetHeight);
        navWarp.style.height = navWarp.offsetHeight - 88 + "px";//固定高度占位,避免悬浮时列表抖动
        var navContent = document.getElementById("navContent");
        mescroll.optUp.onScroll = function (mescroll, y, isUp) {
//					console.log("up --> onScroll 列表当前滚动的距离 y = " + y + ", 是否向上滑动 isUp = " + isUp);
            if (y >= navWarp.offsetTop - 88) {
                navContent.classList.add("nav-fixed");
            } else {
                navContent.classList.remove("nav-fixed");
            }

        }
    }


    var paramObject = getParamObject();

    //上拉加载的回调 page = {num:1, size:10}; num:当前页 默认从1开始, size:每页数据条数,默认10
    function upCallback(page) {
        paramObject.pageNumber = page.num; // 页码, 默认从1开始 如何修改从0开始 ?
        paramObject.pageSize = page.size; // 页长, 默认每页10条
        paramObject.contentId = userId; // 页长, 默认每页10条
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        console.log(index);
        if (index == 0) {
            paramObject.postType = 'POSTS'; // 帖子
            paramObject.viewType = 'MINE'; // 我发布的帖子
        } else if (index == 1) {
            paramObject.postType = 'TREASURE'; // 帖子
            paramObject.viewType = 'MINE'; // 我发布的帖子
        } else if (index == 2) {
            paramObject.viewType = 'ISGOOD'; //我点赞过得帖子跟藏品
        } else if (index == 3) {
            paramObject.postType = 'AUCTION'; // 帖子
        }
        getPost('start_time');
    }

    // 设置列表数据
    function setListData(curPageData) {
        var str = "";
        for (var i = 0; i < curPageData.length; i++) {
            var pd = curPageData[i];
            let postText = "";
            let dateId = '';
            if (pd.text.length > 40) {
                postText = pd.text.substring(0, 120) + "...<span style='color:#6eafff'>全文</span>";
            } else {
                postText = pd.text
            }
            var imgSrc = pd.images ? (pd.images.split(';')) : 'img/association/videoImgbig.jpg';
            console.log(imgSrc);
            if (pd.postType == 'AUCTION') {
                dateId = pd.itemId;
            } else {
                dateId = pd.postId;
            }
            str += '<li>';

            if (pd.postType == 'AUCTION') {//拍品
                str += '<h1 class="title" onclick="window.location.href=\'productDetail.html?productId=' + dateId + '\'">' + pd.title + '</h1>';
                str += '<div class="describe" onclick="window.location.href=\'productDetail.html?productId=' + dateId + '\'">' + postText + '</div>'
            } else {//帖子或者藏品
                str += '<h1 class="title" onclick="window.location.href=\'post_detail.html?postId=' + dateId + '\'">' + pd.title + '</h1>';
                str += '<div class="describe" onclick="window.location.href=\'post_detail.html?postId=' + dateId + '\'">' + postText + '</div>'
            }
            // '<div class="describe" onclick="window.location.href=\'post_detail.html?postId='+pd.postId+'\'">'+postText+'</div>'
            // str += '<div class="img_big" onclick="window.location.href=\'post_detail.html?postId='+pd.postId+'\'"><img src="'+imgSrc+'"></div>'+

            str += '<dl id="bigimg" class="img_big  part' + pd.plate + '">' + postImgHtml(pd.mainVideo, pd.images, dateId, pd.postType, pd.plate) + '</dl>';
            /* if(pd.images){
                str += '<dl   id="bigimg" class="img_big part'+pd.plate+'">'
                for(var j = 0;j<pd.plate;j++){
                    str +='<dd onclick="img_big(\''+imgSrc[j]+'\')"><img src="'+link+imgSrc[j]+'"></dd>'
                }
                str += '</dl>'
            }else{
                str += '<dl id="bigimg" class="img_big"  onclick="videoPlay(\''+pd.mainVideo+'\')"><dd><img src="img/association/videoImgbig.jpg"></dd></dl>'

            } */

            if (pd.groupId || pd.hordeId || pd.themeId) {
                str += '<div class="bt_box">';
                //圈子标签
                if (Istrue(pd.groupId)) {
                    str += '<div class="quanzi" onclick="window.location.href=\'circleDetail.html?groupId=' + pd.groupId + '\'">' +
                        '<img src="img/index/lable1_1.png"><p>' + pd.groupName + '</p><img src="img/index/lable1_2.png">' +
                        '</div>'
                }
                //部落标签
                if (Istrue(pd.hordeId)) {
                    str += '<div class="tribe" onclick="window.location.href=\'circleDetail.html?hordeId=' + pd.hordeId + '\'">' +
                        '<img src="img/index/lable2_1.png"><p>' + pd.hordeName + '</p>' +
                        '</div>'
                }

                //话题标签
                if (Istrue(pd.themeId)) {
                    str += '<div class="lable" onclick="window.location.href=\'attention_topic.html?themeId=' + pd.themeId + '\'">' +
                        '<p>' + pd.themeName + '</p>' +
                        '</div>'
                }
                str += '</div>'
            }


            if (pd.postType == 'POSTS' || pd.postType == 'TREASURE') {
                str += '<div class="operation">';
                //分享
                // str +='<p class="share" onclick="window.location.href=\'post_detail.html?postId='+pd.postId+'\'">'+NumberHandle(pd.commentNum)+'</p>'
                // str +='<p class="share" onclick="hint(\'该功能暂未开放\')">0</p>'
                str += '<p class="share">' + NumberHandle(pd.browseNum) + '</p>';
                //评论
                str += '<p class="conment" onclick="window.location.href=\'post_detail.html?postId=' + pd.postId + '\'">' + NumberHandle(pd.commentNum) + '</p>';
                //点赞
                if (pd.plantGrass == true) {
                    str += '<p class="like hover like' + pd.postId + '" onclick="postcollect(\'' + pd.postId + '\')">' + NumberHandle(pd.goodNum) + '</p>'
                } else {
                    str += '<p class="like like' + pd.postId + '" onclick="postcollect(\'' + pd.postId + '\')"><img src="">' + NumberHandle(pd.goodNum) + '</p>'
                }
                str += '</div>'
            }


            /* str +='<div class="operation">'+
                    '<p class="conment" onclick="window.location.href=\'post_detail.html?postId='+pd.postId+'\'">'+NumberHandle(pd.commentNum)+'</p>'
                    if(pd.plantGrass == true){
                        str +='<p class="like hover like'+pd.postId+'" onclick="postcollect(\''+pd.postId+'\')">'+NumberHandle(pd.goodNum)+'</p>'
                    }else{
                        str +='<p class="like like'+pd.postId+'" onclick="postcollect(\''+pd.postId+'\')">'+NumberHandle(pd.goodNum)+'</p>'
                    }
                str +='</div>'+ */
            str += '</li>'
        }
        $("#dataList").append(str);
        // setTimeout(function(){
        // imgHeight();
        // },100)

    }

    // 初始化标签HTML
    function initLabelHTML(tagArray) {
        var labelHTML = '';
        for (var i = 0; i < tagArray.length; i++) {
            labelHTML += '<p>#' + tagArray[i] + '</p>';
        }
        return labelHTML;
    }


    /**
     * 私信TA
     */
    function privateLetterTA() {
        localStorage.setItem('rong_target_name', $('.name').text());
        location.href = 'messageChat.html?targetId=' + userId + '&targetType=1';
    }

</script>

<script>


    $("#menu ul li").click(function () {
        $("#menu ul li").removeClass("current");
        $(this).addClass("current");
    });
    $(".click").click(function () {
        $(this).parent().hide();
    })

    /* $(".morebt").click(function(){
        if($(".moreMenu").hasClass("dis"))
            $(".moreMenu").removeClass("dis")
        else
            $(".moreMenu").addClass("dis")
    }); */


</script>
</body>
</html>