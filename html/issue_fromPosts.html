<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>发布内容</title>
    <meta content="width=device-width,target-densitydpi=device-dpi, user-scalable=0" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="true" name="HandheldFriendly"/>
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta content="模型APP内测招募" property="title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="image"/>

    <meta content="模型APP内测招募" property="og:title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="og:image"/>
    <script type="text/javascript">
        if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
            var version = parseFloat(RegExp.$1);
            if (version > 2.3) {
                var phoneScale = parseInt(window.screen.width) / 750;
                document.write('<meta name="viewport" content="width=750, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
            } else {
                document.write('<meta name="viewport" content="width=, target-densitydpi=device-dpi">');
            }
        } else {
            document.write('<meta name="viewport" content="width=750, user-scalable=no">');
        }
    </script>
    <link href="css/style.css" rel="stylesheet">
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>
    <script src="js/jquery.cookie.js" type="text/javascript"></script>


    <!-- 上传图片后方向不对调整 -->
    <script src="js/exif.js" type="text/javascript"></script>

    <link href="css/mtween.css" rel="stylesheet">


</head>

<body>
<div id="object">
    <div class="mescroll content" style="top:0;background: white;">
        <div class="cover_box">
            <p class="title">上传封面</p>
            <ul class="img_box">
                <!-- <li class="horizontal_img">
                    <div class="upload_input" id="horizontal">
                        <div style="position: absolute;left:0;top:0;width:100%;height:100%;"><img id="resultImg" src="img/addimg.png" style="width: 100%;display:block;height: 100%;"></div>
                        <div style="width:100%;height:100%;position: absolute;left:0;top:0;"><label id="lablel_1" style="width:160px;height:90px;position: absolute;left:0;top:0;"><input type="file" accept="image/*" name="file" id="file_1" style="width:100%;height:100%;opacity:0;position: absolute;left:0;top:0;z-index: 1;"></label></div>

                    </div>
                    <p class="nameTex">横图</p>
                </li> -->
                <li class="vertical_img">
                    <div class="upload_input" id="vertical">
                        <div style="position: absolute;left:0;top:0;width:100%;height:100%;"><img id="resultImg2"
                                                                                                  src="img/addimg2.png"
                                                                                                  style="width: 100%;display:block;height: 100%;">
                        </div>
                        <div style="width:100%;height:100%;position: absolute;left:0;top:0;"><label id="lablel_2"
                                                                                                    style="width:90px;height:160px;position: absolute;left:0;top:0;"><input
                                accept="image/*" id="file_2" name="file"
                                style="width:100%;height:100%;opacity:0;position: absolute;left:0;top:0;z-index: 1;"
                                type="file"></label></div>

                    </div>
                    <!-- <p class="nameTex">竖图</p> -->
                </li>
            </ul>
        </div>


        <div class="msg">
            <div class="select_box sify_select">
                <p class="name" style="width: 168px;">分类</p>
                <div class="lable" style="width: 500px;">
                    <span></span>
                    <img alt="" src="img/issue/arrow.png"/>
                </div>
                <div class="sify_box">
                    <div class="oneList">
                        <ul>

                        </ul>
                    </div>
                    <div class="twoList">
                        <ul class="part1">

                        </ul>

                    </div>
                </div>


            </div>
            <div class=" select_box save_case">
                <p class="name" style="width: 168px;">保存情况</p>
                <p class="lable" style="width: 500px;"><span title=""></span><img alt="" src="img/issue/arrow.png"/></p>
                <div class="case_box" style="display: none;	">
                    <ul class="case">
                        <li data-title="BRAND_NEW" style="margin-top: 28px;">全新</li>
                        <li data-title="SECOND_HAND">二手</li>
                        <!--<li>破损</li>-->
                    </ul>
                </div>
            </div>


            <ul class="custom">

            </ul>
            <div class="addbt">+添加自定义标签</div>

        </div>
        <div class="publish" style="display: block;">
            <button class="next" onclick="fromPosts()">发布</button>
        </div>

        <div class="hint_box">
            <p></p>
        </div>
    </div>

    <!--自定义条目编辑-->
    <div id="topic">
        <div class="head">
            <p class="title">添加自定义标签</p>
            <p class="close"></p>
            <button class="confirm" onclick="saveTitle()">完成</button>
        </div>
        <div class="container">
            <div class="topic_box">
                <ul>

                </ul>

                <button class="add_topic" onclick="addTopic()">+ 新增自定义标签</button>
            </div>
        </div>

    </div>

    <!--提示框-->
    <div id="text_box">
        <div class="click"></div>
        <div class="text" style="height:350px">
            <p class="title">新增自定义标签</p>
            <input class="input" maxlength="10" placeholder="新增自定义标签" type="text"/>
            <div class="closebt">完成</div>
        </div>
    </div>

    <!--取消关注提示框-->
    <div class="hint_box3" style="display: none;">
        <div class="click3" onclick="deletehint()"></div>
        <div class="box">
            <p class="text">确定要删除该自定义标签吗？</p>
            <div class="bt">
                <button class="closeHint" onclick="deletehint()">取消</button>
                <button class="affirm" onclick="afmitdelete()">确定</button>
            </div>
        </div>
    </div>


    <section class="page">
        <header><a class="btn" href="javascript:" id="saveBtn">保存</a></header>
        <div class="con">
            <canvas id="c" style="background: rgba(0,0,0,1);"></canvas>
            <div id="select">
                <span class="top"></span>
                <span class="right"></span>
                <span class="bottom"></span>
                <span class="left"></span>
                <span class="left-top"></span>
                <span class="left-bottom"></span>
                <span class="right-top"></span>
                <span class="right-bottom"></span>
            </div>
        </div>
    </section>


</div>
<script src="js/common.js"></script>
<script src="js/jquery.cookie.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
<script>
    shareMsg(); //分享

    $("#object").css({'min-height': $(window).height()});
    var postId = getQueryStringByName("postId");
    var type = getQueryStringByName("type");


    //		初始化获取分类
    cates();


    var height = $(window).height();
    height = height - 88;
    $("#topic .topic_box").height(height);
    console.log(height);
    var lenght = $(".topic_box ul li").length;
    console.log(lenght);
    sort();


    $(".addbt").click(function () {
        compileTopic();
    });

    //编辑自定义标题
    function compileTopic() {
        var result = "";
        lenght = $(".custom li").length;
        console.log(lenght);
        for (var i = 0; i < lenght; i++) {
            let name = $(".custom .name").eq(i).text();
            let title = $(".custom .lable span").eq(i).text();
            result += '<li><p class="title">' + name + '</p><input class="name" value="' + title + '"></input><div class="delete" ">删除</div></li>'
        }
        console.log(result);
        $(".topic_box li").remove();
        $(".topic_box ul").append(result);
        $("#topic").show();
        deleteTopic();
    }

    //			从新排序
    function sort() {
        for (var i = 0; i < lenght; i++) {
            let index = i + 1;
            $(".topic_box .title").eq(i).text("自定义" + index)
        }
    }


    //			点击删除自定义按钮调用
    function deleteTopic() {
        $(".delete").bind("click", function () {
            console.log(9999);
            $(".hint_box3").fadeIn(200);
            $(this).parent().addClass("deleteDfini");
        })

    }

    //			关闭删除浮层调用
    function deletehint() {
        $(".hint_box3").fadeOut(200);
        $(".topic_box ul li").removeClass("deleteDfini")
    }

    //			确认删除自定义调用
    function afmitdelete() {
        $(".topic_box ul .deleteDfini").remove();
        $(".hint_box3").fadeOut(200);
        sort();
    }

    $(".close").click(function () {

    });


    //			添加自定义条目
    function addTopic() {
        lenght = $(".topic_box ul li").length;
        if (lenght >= 10) {
            alert("最多可添加10个自定义标签")
        } else {
            $("#text_box").fadeIn(200);
            var len = lenght + 1;
            console.log(len);
            $("#text_box .title").text("请输入自定义标签")
        }
    }

    //      关闭提示框
    $(".click").click(function () {
        $(this).parent().fadeOut(200);
        toggleBody(0)
    });
    $(".closebt").click(function () {
        var title = $(".input").val();
        if (title == "") {
            alert("请输入自定义标签");
            return false;
        }
        var len = lenght + 1;
        let result = '<li><p class="title">' + title + '</p><input class="name" placeholder="请输入自定义标签"></input><div class="delete">删除</div></li>';
        $(".topic_box ul").append(result);
        $(this).parent().parent().fadeOut(200);
        $(".input").val("");
        toggleBody(0);
        deleteTopic();
    });

    function saveTitle() {
        var result = "";
        lenght = $(".topic_box ul li").length;
        console.log(lenght);
        for (var i = 0; i < lenght; i++) {
            let title = $(".topic_box ul .title").eq(i).text();
            let name = $(".topic_box ul .name").eq(i).val();
            result += '<li class=" select_box"><p class="name">' + title + '</p>' +
                '<p class="lable"><span>' + name + '</span><img src="img/issue/arrow.png" alt="" /></p></li>'
        }
        console.log(result);
        $(".custom li").remove();
        $(".custom").append(result);
        $("#topic").hide();

    }


    $(".sify_select .lable,.sify_box .oneList").toggleWin(".sify_box");
</script>
<script>
    //  	上传照片时验证不同页面不同元素验证


    $(".close").click(function () {
        $(this).parent().parent().hide();
    });


    $(".save_case .lable").toggleWin(".case_box");
    $(".save_case .case_box li").click(function () {
        $(".case_box").hide();
        let tex = $(this).text();
        let title = $(this).attr('data-title');
        $(".save_case .lable span").text(tex);
        $(".save_case .lable span").attr('title', title)
    });


    var postId = getQueryStringByName("postId");


    //帖子转藏品
    function fromPosts() {
        var form = new FormData();
        //纵向封面
        var verticalFile = $("#resultImg2").attr("src");
        if (verticalFile == 'img/addimg2.png') {
            text = "请上传封面";
            hint(text);
            return false;
        } else {
            form.append('verticalFile', base64toFile(verticalFile));
        }

        if ($(".sify_select .lable span").text() == "") {
            text = "请选择分类";
            hint(text);
            return false;
        }

        if ($(".save_case .lable span").text() == "") {
            text = "请填写保存情况";
            hint(text);
            return false;
        }


        $("body").append('<div id="loading"><div class="gif"><img src="img/timg.gif"></div></div>');

        //纵向封面
        var verticalFile = $("#resultImg2").attr("src");
        if (!verticalFile == 'img/addimg2.png') {
            form.append('verticalFile', base64toFile(verticalFile));
        }
        //获取自定义标题内容
        if ($(".custom li").length > 0) {
            for (var i = 0; i < $(".custom li").length; i++) {
                var title = $(".custom li").eq(i).children(".name").text();
                var texts = $(".custom li").eq(i).children(".lable").children("span").text();
                form.set('paramArray[' + i + '].name', title);
                form.set('paramArray[' + i + '].value', texts);
            }
        }
        form.append("preservation", $(".save_case .lable span").attr('title'));
        form.append("cateId", $(".sify_select .lable span").attr("data-cateId"));
        form.append("postId", postId);
        form.append("requestId", 'd79b9efa995f');
        form.append("timestamp", new Date().getTime());
        $.ajax({
            url: link + "/goods/treasure/fromPosts",
            type: "POST",
            contentType: false,
            processData: false,
            data: form,
            dataType: "Json",
            success: function (res) {
                console.log(res);

                handler({
                    res: res,
                    fun1: function () {
                        window.location.href = "myHome.html"
                        /* if (postStatus == "TEMPORARY") {

                        } else {
                            send_create(postStatus)
                        } */
                    }, fun2: function () {
                        $("#loading").remove()
                    }, fun3: function () {
                        $("#loading").remove()
                    }, fun4: function () {
                        $("#loading").remove()
                    }, fun5: function () {
                        $("#loading").remove()
                    }
                })
            },
            error: function (e) {
            }
        });
    }

</script>

<!--上传头像js-->
<script src="js/MTween.js" type="text/javascript"></script>
<script src="js/uploadCover.js" type="text/javascript"></script>


</body>

</html>
