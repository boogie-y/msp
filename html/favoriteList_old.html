<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>藏品管理</title>
    <meta content="width=device-width,target-densitydpi=device-dpi, user-scalable=0" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="true" name="HandheldFriendly"/>
    <meta content="yes" name="apple-touch-fullscreen"/>
    <script type="text/javascript">
        if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
            var version = parseFloat(RegExp.$1);
            if (version > 2.3) {
                var phoneScale = parseInt(window.screen.width) / 750;
                document.write('<meta name="viewport" content="width=750, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
            } else {
                document.write('<meta name="viewport" content="width=, target-densitydpi=device-dpi">');
            }
        } else {
            document.write('<meta name="viewport" content="width=750, user-scalable=no">');
        }
    </script>
    <link href="css/style.css" rel="stylesheet">
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>

</head>
<body>
<div id="favoriteList">
    <div class="head">
        <div class="back" onclick="window.location.href='favorite.html'"></div>
        <p class="title">展示位（<span>0/8</span>）</p>
    </div>
    <div class="content">
        <!--<div class="head_title">
            <p class="text">展示位（<span class="number1">5</span>/<span class="numbertotal">6</span>）</p>
            <p class="extend">扩充展位</p>
        </div>-->
        <ul class="showList part">

            <!--<li>
                <img src="img/productList/img.jpg" alt="" class="img_big" />
                <div class="detail">
                    <p class="name">正品手办正品手办...</p>
                    <div class="number">
                        <p class="num1">122</p>
                        <p class="num2">123</p>
                        <p class="num3">123</p>
                    </div>
                    <div class="bt_box">
                        <button>替换</button>
                        <button>下架</button>
                        <button>上移</button>
                        <button style="margin:0">下移</button>
                    </div>
                </div>
            </li>
            <li>
                <img src="img/productList/img.jpg" alt="" class="img_big" />
                <div class="detail">
                    <p class="name">正品手办正品手办...</p>
                    <div class="number">
                        <p class="num1">122</p>
                        <p class="num2">123</p>
                        <p class="num3">123</p>
                    </div>
                    <div class="bt_box">
                        <button>替换</button>
                        <button>下架</button>
                        <button>上移</button>
                        <button style="margin:0">下移</button>
                    </div>
                </div>
            </li>

            <li>
                <img src="img/productList/img.jpg" alt="" class="img_big" />
                <div class="detail">
                    <p class="name">正品手办正品手办...</p>
                    <div class="number">
                        <p class="num1">122</p>
                        <p class="num2">123</p>
                        <p class="num3">123</p>
                    </div>
                    <div class="bt_box">
                        <button>替换</button>
                        <button>下架</button>
                        <button>上移</button>
                        <button style="margin:0">下移</button>
                    </div>
                </div>
            </li>

            <li>
                <img src="img/productList/img.jpg" alt="" class="img_big" />
                <div class="detail">
                    <p class="name">正品手办正品手办...</p>
                    <div class="number">
                        <p class="num1">122</p>
                        <p class="num2">123</p>
                        <p class="num3">123</p>
                    </div>
                    <div class="bt_box">
                        <button>替换</button>
                        <button>下架</button>
                        <button>上移</button>
                        <button style="margin:0">下移</button>
                    </div>
                </div>
            </li>

            <li>
                <img src="img/productList/img.jpg" alt="" class="img_big" />
                <div class="detail">
                    <p class="name">正品手办正品手办...</p>
                    <div class="number">
                        <p class="num1">122</p>
                        <p class="num2">123</p>
                        <p class="num3">123</p>
                    </div>
                    <div class="bt_box">
                        <button>替换</button>
                        <button>下架</button>
                        <button>上移</button>
                        <button style="margin:0">下移</button>
                    </div>
                </div>
            </li>-->


        </ul>
        <div class="add_box">
            <img src="img/favorite/ico_add.png">
            <p>添加藏品</p>
        </div>
    </div>


    <div class="object_box">
        <div class="head_title">
            <div class="back"></div>
            <p class="title">添加藏品</p>
        </div>
        <ul>
            <!--<li class=""><img src="img/favorite/img.png"><div class="select"></div></li>
            <li class=""><img src="img/favorite/img.png"><div class="select"></div></li>
            <li class=""><img src="img/favorite/img.png"><div class="select"></div></li>
            <li class=""><img src="img/favorite/img.png"><div class="select"></div></li>
            <li class=""><img src="img/favorite/img.png"><div class="select"></div></li>
            <li class=""><img src="img/favorite/img.png"><div class="select"></div></li>
            <li class=""><img src="img/favorite/img.png"><div class="select"></div></li>
            <li class=""><img src="img/favorite/img.png"><div class="select"></div></li>
            <li class=""><img src="img/favorite/img.png"><div class="select"></div></li>
            <li class=""><img src="img/favorite/img.png"><div class="select"></div></li>-->
        </ul>
    </div>

    <div class="hint_box">
        <p></p>
    </div>

</div>

<script src="js/common.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>

<script>

    shareMsg(); //分享
    getList('SHOWING');
    getList('DISSHOW');


    var oldTreasureId = '';


    //获取藏品列表
    function getList(siteType) {
        var paramObject = getParamObject();
        paramObject.siteType = siteType; // 请求时间戳
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/goods/treasure/getList?" + $.param(paramObject),
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        var currenList = res.data;
                        if (siteType == 'SHOWING')
                            showList(currenList);
                        else
                            disShowList(currenList)
                    }
                })
            },
            error: function (e) {

            }
        });
    }


    function showList(currenHtml) {
        console.log(currenHtml);
        var str = '';
        $(".head .title span").text(currenHtml.length + "/8");
        if (currenHtml.length == 8) {
            $(".add_box").hide();
        } else {
            $(".add_box").show();
        }
        for (var i = 0; i < currenHtml.length; i++) {
            let pd = currenHtml[i];
            var imgArr = [];
            imgArr = pd.images.split(";");
            let postText = '';
            if (pd.title.length > 10) {
                postText = pd.title.substring(0, 10) + '...'
            } else {
                postText = pd.title
            }
            console.log(pd.site);

            str += '<li>' +
                '<img src="' + link + imgArr[0] + '" alt="" class="img_big" />' +
                '<div class="detail">' +
                '<p class="name">' + postText + '</p>' +
                '<div class="number">' +
                '<p class="num1">' + pd.masterGood + '</p>' +
                '<p class="num2">' + pd.citizenGood + '</p>' +
                '<p class="num3">' + pd.peopleGood + '</p>' +
                '</div>' +
                '<div class="bt_box">' +
                '<button onclick="replace(\'' + pd.treasureId + '\')">替换</button>' +
                '<button onclick="soldOut(\'' + pd.treasureId + '\')">下架</button>' +
                '<button onclick="moveUp(\'' + pd.treasureId + '\')">上移</button>' +
                '<button onclick="moveDown(\'' + pd.treasureId + '\')" style="margin:0">下移</button>' +
                '</div>' +
                '</div>' +
                '</li>'
        }
        console.log(str);
        $(".showList").html(str)

    }

    function disShowList(currenHtml) {
        var str = '';
        for (var i = 0; i < currenHtml.length; i++) {
            let pd = currenHtml[i];
            var imgArr = [];
            imgArr = pd.images.split(";");
            str += '<li data_id="' + pd.treasureId + '"><img src="' + link + imgArr[0] + '"><div class="select"></div></li>'
        }
        $(".object_box ul").html(str);
        $(".object_box li").click(function () {
            $(".object_box li").removeClass("hover");
            $(this).addClass("hover");
            let id = $(this).attr("data_id");
            if (oldTreasureId == "") {

                addTreasure(id)
            } else {
                replaceTreasure(id)
            }
        })
    }


    //			添加藏品
    function addTreasure(treasureId) {
        var paramObject = getParamObject();
        paramObject.treasureId = treasureId; // 请求时间戳
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/social/cabinet/addTreasure",
            type: 'POST',
            data: paramObject,
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        location.reload()
                    }
                })
            },
            error: function (e) {

            }
        });
    }


    //下架藏品
    function soldOut(treasureId) {
        var paramObject = getParamObject();
        paramObject.treasureId = treasureId; // 请求时间戳
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/social/cabinet/removeTreasure",
            type: 'POST',
            data: paramObject,
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        location.reload()
                    }
                })
            },
            error: function (e) {

            }
        });
    }

    //上移藏品
    function moveUp(treasureId) {
        var paramObject = getParamObject();
        paramObject.treasureId = treasureId; // 请求时间戳
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/social/cabinet/upTreasure",
            type: 'POST',
            data: paramObject,
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        location.reload()
                    }
                })
            },
            error: function (e) {

            }
        });
    }

    //下移藏品
    function moveDown(treasureId) {
        var paramObject = getParamObject();
        paramObject.treasureId = treasureId; // 请求时间戳
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/social/cabinet/downTreasure",
            type: 'POST',
            data: paramObject,
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        location.reload()
                    }
                })
            },
            error: function (e) {

            }
        });
    }


    function replace(TreasureId) {
        oldTreasureId = TreasureId;
        $(".object_box").show();
    }

    //替换藏品
    function replaceTreasure(treasureId) {
        var paramObject = getParamObject();
        paramObject.newTreasureId = treasureId; // 新的ID
        paramObject.oldTreasureId = oldTreasureId; // 老的ID
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/social/cabinet/replaceTreasure",
            type: 'POST',
            data: paramObject,
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        location.reload()
                    }
                })
            },
            error: function (e) {

            }
        });
    }


    $(".add_box").click(function () {
        $(".object_box").show();
    });
    $(".object_box .back").click(function () {
        oldTreasureId = '';
        $(".object_box").hide();
    })


</script>
</body>
</html>