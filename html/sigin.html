<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>注册</title>
    <meta content="width=device-width,target-densitydpi=device-dpi, user-scalable=0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="true" name="HandheldFriendly">
    <meta content="yes" name="apple-touch-fullscreen">
    <link href="css/style.css" rel="stylesheet">
    <meta content="模型APP内测招募" property="title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="image"/>

    <meta content="模型APP内测招募" property="og:title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="og:image"/>
    <script type="text/javascript">
        if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
            let version = parseFloat(RegExp.$1);
            if (version > 2.3) {
                let phoneScale = window.screen.width / 750;
                document.write('<meta name="viewport" content="width=750, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
            } else {
                document.write('<meta name="viewport" content="width=, target-densitydpi=device-dpi">');
            }
        } else {
            document.write('<meta name="viewport" content="width=750, user-scalable=no">');
        }
    </script>
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>
</head>
<body>
<div id="sigin">
    <!--验证码登录输入框-->
    <div class="login_box" style="margin-top: 40px;">
        <!--用户名-->
        <div class="input_box">
            <label for="username"></label>
            <input class="useName" id="username" maxlength="20" placeholder="请设置用户名" style="border: none; width: 620px;"
                   type="text">
        </div>
        <!--手机号码-->
        <div class="input_box">
            <label for="mobile"></label>
            <input class="mobile" id="mobile" maxlength="11" onkeyup="this.value=this.value.replace(/[^\d]/g,'')"
                   placeholder="请输入手机号"
                   style="border: none; width: 620px;" type="tel">
        </div>
        <!--手机验证码-->
        <div class="input_box">
            <label for="sms_code"></label>
            <input class="code" id="sms_code" maxlength="6" placeholder="请输入短信验证码" type="text">
            <button class="send send_code" onclick="sendSmsCode('register', null);" type="button">发送验证码</button>
        </div>
        <!--密码-->
        <div class="input_box password">
            <label for="password"></label>
            <input class="use_ps" id="password" maxlength="20"
                   onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[\W]/g,''))"
                   onblur="inspectPassword(this);"
                   onkeyup="value=value.replace(/[\W]/g,'')" placeholder="请输入密码" style="width: 620px;"
                   type="password">
            <p>密码为至少6个字符的英文字母、数字或字符</p>
        </div>
        <!--确认密码-->
        <div class="input_box password">
            <label for="confirm_password"></label>
            <input class="use_ps" id="confirm_password" maxlength="20"
                   onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[\W]/g,''))"
                   onblur="inspectPassword(this);"
                   onkeyup="value=value.replace(/[\W]/g,'')" placeholder="请再次输入密码" style="width: 620px;"
                   type="password">
            <p>密码为至少6个字符的英文字母、数字或字符</p>
        </div>
    </div>

    <button class="submitbt" onclick="registerAndLogin();" type="submit">注册并登录</button>

    <div class="hint_box" style="bottom: 200px;">
        <p></p>
    </div>
</div>
<script src="js/common.js" type="text/javascript"></script>
<script type="text/javascript">
    shareMsg(); //分享


    // 更新验证码图片
    updateCaptchaImage();

    /**
     * 更新验证码图片
     */
    function updateCaptchaImage() {
        $('#img_code').next().attr('src', link + '/kaptcha?v=' + new Date().getTime());
    }

    /**
     * 检查密码
     * @param that
     */
    function inspectPassword(that) {
        let length = $(that).val().length;
        if (length < 6) {
            $(that).next().fadeIn(300);
            setTimeout(function () {
                $(that).next().fadeOut(300)
            }, 2000);
        }
    }

    /**
     * 注册并登录
     */
    let username, mobile, smsCode, password, confirmPassword;
    let registerAndLogin = function () {
        // 检查请求参数
        let result = checkRequestParameters();
        if (false === result) return;

        $.ajax({
            url: link + '/register',
            type: 'POST',
            data: {
                username: username,
                mobile: mobile,
                smsCode: smsCode,
                password: password,
                confirmPassword: confirmPassword
            }
        }).done(function (response) {
            console.log(response);

            handler({
                res: response,
                fun1: function () {
                    // 进入社群首页
                    location.href = '/';
                },
                fun2: function () {
                    hint(response.msg);
                    // 重置验证码
                    updateCaptchaImage();
                }
            });
        });
    };

    /**
     * 检查请求参数
     * @return {boolean}
     */
    function checkRequestParameters() {
        username = $('#username').val(); //用户名
        mobile = $('#mobile').val();  //手机号码
        smsCode = $('#sms_code').val(); //手机验证码
        password = $('#password').val(); //用户密码
        confirmPassword = $('#confirm_password').val(); //用户确认密码

        if (username === '') {
            hint('请输入用户名');
            return false;
        }
        if (mobile === '') {
            hint('请输入手机号');
            return false;
        }
        if (!reg.test(mobile)) {
            hint('手机号码格式错误');
            return false;
        }
        if (smsCode === '') {
            hint('请输入短信验证码');
            return false;
        }
        if (password === '') {
            hint('请输入密码');
            return false;
        }
        if (password !== confirmPassword) {
            hint('两次输入的密码不一致');
            return false;
        }
        return true;
    }
</script>
</body>
</html>