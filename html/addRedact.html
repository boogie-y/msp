<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>编辑地址</title>
    <meta content="width=device-width,target-densitydpi=device-dpi, user-scalable=0" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="true" name="HandheldFriendly"/>
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta content="模型APP内测招募" property="title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="image"/>

    <meta content="模型APP内测招募" property="og:title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="og:image"/>
    <script type="text/javascript">
        if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
            var version = parseFloat(RegExp.$1);
            if (version > 2.3) {
                var phoneScale = parseInt(window.screen.width) / 750;
                document.write('<meta name="viewport" content="width=750, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
            } else {
                document.write('<meta name="viewport" content="width=, target-densitydpi=device-dpi">');
            }
        } else {
            document.write('<meta name="viewport" content="width=750, user-scalable=no">');
        }
    </script>
    <link href="css/style.css" rel="stylesheet">
    <link href="city/city.css" rel="stylesheet">
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>


</head>
<body>
<div id="redact">

    <div class="content">
        <div class="msg_box">
            <div class="input_box">
                <p class="tex">收货人</p>
                <input class="rename" maxlength="15" placeholder="请填写收货人姓名" type="text"/>
            </div>
            <div class="input_box">
                <p class="tex">手机号</p>
                <input class="mobile" maxlength="11" placeholder="请填写收货人手机号" type="tel"/>
            </div>
            <div class="input_box" style="margin-bottom:0;border-bottom: 1px solid #dddddd;">
                <!--<p class="tex">联系地址</p>
                <select name="province" class="province" id="province_select"></select>
                <select name="city" class="city" id="city_select"></select>

                -->
                <p class="left tex">所在地区</p>
                <div class="right">
                    <input class="input" id="address" maxlength="30" placeholder="请填写收货地址" type="text">
                </div>
            </div>
            <div class="input_box">
                <p class="tex">详细地址</p>
                <input class="detailAdd" maxlength="100" placeholder="请填写详细地址" type="text">
            </div>
            <div class="defaultSelect">
                <p class="txt">设置默认地址</p>
                <div class="select">
                    <div class="cire"></div>
                    <div class="parent">
                        <div class="line"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="foot_botton">
        <button class="deleteAdd" onclick="deleteAdd()">删除</button>
        <button class="submitbt" onclick="submitbt()">保存</button>
    </div>


    <section id="mymodal">
        <div class="modal-main">
            <p class="address-title">收货地址</p>
            <!--<p class="close">x</p>-->
            <ul class="optionwrapper">
                <li class="option-menu option-menu-one active-option">请选择</li>
                <li class="option-menu option-menu-two"></li>
                <li class="option-menu option-menu-three"></li>
            </ul>
            <div class="option-content">
                <ul class="option-group option-group-one" data-index="0" style="display: block">
                </ul>
                <ul class="option-group option-group-two" data-index="1">
                </ul>
                <ul class="option-group option-group-three" data-index="2">
                </ul>
            </div>
        </div>
    </section>


    <div class="hint_box">
        <p></p>
    </div>


</div>
<script src="js/common.js" type="text/javascript"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
<script src="city/data.js" type="text/javascript"></script>
<script type="text/javascript">
    $('.content').css({'height': $(window).height() - 100});
    shareMsg(); //分享


    var provinceName = "";
    var cityName = '';
    var areaName = '';
    $(document).ready(function () {
        var newData = [];//新数据
        var citysArray = [];//城市
        var areaArray = [];//地区
        var chooseMenuStr = '请选择'; //添加选择title
        function init() {
            //模拟ajax
            setTimeout(() = > {
                newData = [...data;
        ]
            // 初始化省份
            var optionGroupOne = "";
            $.each(newData, function (index, el) {
                optionGroupOne += `<li class="option-list option-list-one">
										<span>${newData[index]["n"]}</span>
										<div class="checked">
										</div>
									</li>`
            });

            $(".option-group-one").html(optionGroupOne)

        },
            100;
        )
        }

        init();


        $("#mymodal").on("click", ".option-menu", function () { //菜单激活
            var i = $(this).index();
            $(this).addClass('active-option').siblings().removeClass('active-option');
            $(".option-group").eq(i).show().siblings().hide()
        });

        //1级 省份点击添加城市
        $("#mymodal").on("click", ".option-list-one", function () {
            var parentIndex = $(this).parent().attr("data-index");
            provinceName = $(this).text().trim();
            console.log(provinceName);
            var provinceIndex = $(this).index();
            $(this).find('.checked').show();
            $(this).siblings().find('.checked').hide();
            $(this).find('span').css({'color': '#ffac1c'});
            $(this).siblings().find('span').css({'color': '#1c2027'});
            // console.log(newData[provinceIndex])
            citysArray = newData[provinceIndex]["c"];
            $(".option-menu").eq(parentIndex).text(provinceName);
            var cityStr = "";
            // console.log(citysArray)
            $.each(citysArray, function (index, el) {
                cityStr += `<li class="option-list option-list-two">
								<span>${citysArray[index]["n"]}</span>
								<div class="checked">
								</div>
							</li>`
            });
            // console.log(cityStr)
            $(".option-group").hide();
            $(".optionwrapper").find(".option-menu").removeClass('active-option');
            $(".option-menu-two").html(chooseMenuStr).addClass('active-option');
            $(".option-group-two").html(cityStr).show();
            $(".option-group-three").html("");
            $(".option-menu-three").html("")
        });


        //2级 城市点击添加城镇
        $("#mymodal").on("click", ".option-list-two", function () {
            var parentIndex = $(this).parent().attr("data-index");
            cityName = $(this).text().trim();
            var cityIndex = $(this).index();
            $(this).find('.checked').show();
            $(this).siblings().find('.checked').hide();
            $(this).find('span').css({'color': '#ffac1c'});
            $(this).siblings().find('span').css({'color': '#1c2027'});
            cityArray = citysArray[cityIndex]["a"];
            $(".option-menu").eq(parentIndex).text(cityName);
            var areaStr = "";
            $.each(cityArray, function (index, el) {
                areaStr += `<li class="option-list option-list-three">
								<span>${cityArray[index]}</span>
								<div class="checked">
								</div>
							</li>`
            });
            $(".option-group").hide();
            $(".optionwrapper").find(".option-menu").removeClass('active-option');
            $(".option-menu-three").html(chooseMenuStr).addClass('active-option');
            $(".option-group-three").html(areaStr).show();
        });
        //3级 选择城镇
        $("#mymodal").on("click", ".option-list-three", function () {
            areaName = $(this).text().trim();
            var parentIndex = $(this).parent().attr("data-index");
            var menuOne = $(".option-menu").eq(0).text();
            var menuTwo = $(".option-menu").eq(1).text();
            var addressVal = menuOne + " " + menuTwo + " " + areaName;
            $(this).find('.checked').show();
            $(this).siblings().find('.checked').hide();
            $(this).find('span').css({'color': '#ffac1c'});
            $(this).siblings().find('span').css({'color': '#1c2027'});
            $(".option-menu").eq(parentIndex).text(areaName);
            $(".modal-main").animate({"bottom": "-900px"}, 200);
            setTimeout(() = > {
                $("#mymodal";
        ).
            fadeOut()
        },
            150;
        )
            $("#address").val(addressVal)
        });

        $(".right").on("click", function () {
            $("#mymodal").show();
            $(".modal-main").animate({"bottom": "0"}, 200)
        });


        $(".close").on("click", function () {
            $(".modal-main").animate({"bottom": "-900px"}, 200);
            setTimeout(() = > {
                $("#mymodal";
        ).
            fadeOut();
        },
            150;
        )
        });

        $("#mymodal").on("click", function (event) {
            var modalMain = $(".modal-main");
            if (!modalMain.is(event.target) && modalMain.has(event.target).length === 0) {
                $(".modal-main").animate({"bottom": "-900px"}, 200);
                setTimeout(() = > {
                    $("#mymodal";
            ).
                fadeOut();
            },
                150;
            )
            }

        })

    });

</script>

<script>
    var addrId = getQueryStringByName('addrId');
    console.log(addrId);
    if (addrId) {
        console.log(addrId);
        getAdd(addrId)
    } else {
        $(".deleteAdd").attr("disabled", "disabled");
        $(".deleteAdd").css({"color": "#afafaf"});
    }
    //			选择默认动画
    $(".defaultSelect").bind(Fuse.Event.START, function () {
        if ($(".hover:visible").length == 0) {
            $(".defaultSelect .select").addClass("hover");
            $(".select .cire").animate({left: 40}, 200);
            $(".select .line").animate({left: 0}, 200)

        } else {
            $(".defaultSelect .select").removeClass("hover");
            $(".select .cire").animate({left: 0}, 200);
            $(".select .line").animate({left: -80}, 200)
        }
    });

    //			表单验证
    function submitbt() {
        let text;
        if ($(".rename").val() == "") {
            text = "请填写收货人";
            hint(text);
            return false;
        }

        if (!reg.test($('.mobile').val())) {
            text = "请输入正确的手机号码";
            hint(text);
            return false;
        }

        if ($("#address").val() == "") {
            text = "请填写区域地址";
            hint(text);
            return false;
        }

        if ($(".detailAdd").val() == "") {
            text = "请填写地址";
            hint(text);
            return false;
        }
        console.log($("#address").val());

        var defaults = $(".defaultSelect .hover").length;
        addAddress(addrId, defaults)
    }

    function addAddress(addrId, defaults) {
        var addressList = [];
        var address = $("#address").val();
        addressList = address.split(" ");
        console.log(addressList);
        var paramObject = getParamObject();
        paramObject.addrId = addrId; // 用户名
        paramObject.fullName = $(".rename").val(); // 用户名
        paramObject.mobile = $('.mobile').val(); // 电话
        paramObject.country = '中国'; // 国家
        paramObject.province = addressList[0]; // 省份
        paramObject.city = addressList[1]; // 城市
        paramObject.district = addressList[2]; // 城市
        paramObject.contactAddr = $('.detailAdd').val(); // 详细地址
        paramObject['default'] = defaults; // 是否默认
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/user/user-addr/addAddress",
            data: paramObject,
            type: 'POST',
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        if (addrId) {
                            alert('修改成功')
                        } else {
                            alert('添加成功')
                        }

                        history.back();
                    }

                })
            },
            error: function (e) {

            }
        });
    }

    //获取修改地址信息
    function getAdd(addrId) {
        var paramObject = getParamObject();
        paramObject.addrId = addrId; // 请求时间戳
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/user/user-addr/getOneAddress?" + $.param(paramObject),
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        var pd = res.data;
                        $(".rename").val(pd.fullName);
                        $(".mobile").val(pd.mobile);
                        $("#address").val(pd.province + ' ' + pd.city + ' ' + pd.district);
                        $(".detailAdd").val(pd.contactAddr);
                        if (pd['default'] == true) {
                            $(".defaultSelect .select").addClass("hover");
                            $(".defaultSelect .cire").css({left: 40});
                            $(".defaultSelect .line").css({left: 0})
                        }

                    }
                })
            },
            error: function (e) {

            }
        });
    }


    //删除地址
    function deleteAdd() {
        var paramObject = getParamObject();
        paramObject.addrId = addrId; // 地址ID
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/user/user-addr/deleteAddress",
            type: "delete",
            data: paramObject,
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        alert('删除成功');
                        history.back();
                    }
                })
            },
            error: function (e) {

            }
        });
    }


</script>
</body>
</html>