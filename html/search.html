<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>搜索</title>
    <meta content="width=device-width,target-densitydpi=device-dpi, user-scalable=0" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="true" name="HandheldFriendly"/>
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta content="模型APP内测招募" property="title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="image"/>

    <meta content="模型APP内测招募" property="og:title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="og:image"/>
    <script type="text/javascript">
        if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
            var version = parseFloat(RegExp.$1);
            if (version > 2.3) {
                var phoneScale = parseInt(window.screen.width) / 750;
                document.write('<meta name="viewport" content="width=750, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
            } else {
                document.write('<meta name="viewport" content="width=, target-densitydpi=device-dpi">');
            }
        } else {
            document.write('<meta name="viewport" content="width=750, user-scalable=no">');
        }
    </script>
    <link href="css/style.css" rel="stylesheet">
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>
    <!--上拉加载css-->
    <link href="mescroll/mescroll.min.css" rel="stylesheet"></link>
    <style type="text/css">
        .mescroll {
            position: fixed;
            top: 233px;
            bottom: 0px;
            height: auto;
        }

        .mescroll-totop {
            bottom: 140px;
        }

        input[type="search"]::-webkit-search-cancel-button {
            display: none;

        }

        .input-kw {
            -webkit-appearance: none;
        }


    </style>
</head>

<body>
<div id="search">
    <div class="head_box">
        <div class="search_box">
            <div class="search">
                <!-- <select name=""  id="select">
                    <option value="AUCTION">拍品</option>
                    <option value="POSTS">帖子</option>
                    <option value="TREASURE">藏品</option>
                    <option value="GROUP">圈子</option>
                    <option value="USER">用户</option>
                </select>
                <p>|</p> -->
                <div class="search_ico"></div>
                <!-- <input type="search" maxlength="10" class="search_input" placeholder="请输入搜索内容" id="searchInput"/> -->
                <form action="" class="input-kw-form">
                    <!-- <input type="search" autocomplete="off" name="baike-search" placeholder="请输入关键词" class="input-kw"> -->
                    <input class="search_input input-kw" id="searchInput" maxlength="10" placeholder="请输入搜索内容"
                           type="search"/>
                </form>
                <div class="delete" onclick="searchClose()"></div>
            </div>
            <script type="text/javascript">
                $('.input-kw-form').on('submit', function (event) {
                    event.preventDefault();
                    search($('#searchInput').val());
                })
            </script>
            <button onclick="history.back(-1)">取消</button>
        </div>

    </div>

    <div id="content">
        <ul class="classify">
            <li class="hover" title="POSTS">帖子</li>
            <li title="AUCTION">拍品</li>
            <li title="TREASURE">藏品</li>
            <li title="GROUP">圈子</li>
            <li title="USER">用户</li>
            <!-- <li>全部</li>
            <li>帖子</li>
            <li>藏品</li>
            <li>圈子</li>
            <li>用户</li> -->
        </ul>
        <div class="hint_tex">


            <div class="hot_search">
                <p class="title">大家都在搜</p>
                <ul id="hostList">

                </ul>
            </div>

            <div class="search_history">
                <div class="head">
                    <p class="title">搜索历史</p>
                    <div class="closebt" onclick="close_history()">清空</div>
                </div>
                <ul class="history">

                </ul>
            </div>
        </div>


        <div class="mescroll" id="mescroll" style="display: none;">
            <ul class="searchlist" id="dataList">

            </ul>
        </div>


        <div class="hint_box" style="bottom: 200px;">
            <p></p>
        </div>

    </div>


</div>


<script src="js/common.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
<script charset="utf-8" src="mescroll/mescroll.min.js"></script>

<script type="text/javascript">

</script>
<script type="text/javascript">

    shareMsg(); //分享
    //		var type='POSTS';
    //		type = $("#select").val();


    // var searchType = POSTS;
    $(".classify li").click(function () {
        $(".classify li").removeClass("hover");
        $(this).addClass("hover");
        // $("searchType")
    });
    //获取热搜关键字

    var paramObject = getParamObject();
    paramObject.timestamp = new Date().getTime(); // 请求时间戳
    paramObject.requestId = md5($.param(paramObject)); // 请求ID
    $.ajax({
        url: link + "/manager/search/getAllRecord?" + $.param(paramObject),
        dataType: "Json",
        success: function (res) {
            console.log(res);
            handler({
                res: res,
                fun1: function () {
                    var str = '';
                    for (var i = 0; i < res.data.length; i++) {
                        var pd = res.data[i];
                        str += '<li onclick="search(\'' + pd.word + '\',\'' + pd.searchType + '\')" data-id=' + pd.searchId + '>' + pd.word + '</li>'
                    }
                    $("#hostList").html(str)
                }
            })
        },
        error: function (e) {
        }
    });


    //		获取用户搜索记录
    var paramObject = getParamObject();
    paramObject.timestamp = new Date().getTime(); // 请求时间戳
    paramObject.requestId = md5($.param(paramObject)); // 请求ID
    $.ajax({
        url: link + "/manager/search/getSearchRecord?" + $.param(paramObject),
        dataType: "Json",
        success: function (res) {
            console.log(res);
            handler({
                res: res,
                fun1: function () {
                    var str = '';
                    for (var i = 0; i < res.data.length; i++) {
                        var pd = res.data[i];
                        str += '<li onclick="search(\'' + pd.word + '\',\'' + pd.searchType + '\')" data-id=' + pd.searchId + '>' + pd.word + '</li>'
                    }
                    $(".history").html(str)
                }
            })
        },
        error: function (e) {
        }
    });

    var searchtype = '';
    var word = '';

    var index = 0;

    function search(word, type) {
        console.log(1111);
        if (word == '') {
            hint('请输入关键字');
            return false;
        }
        searchtype = $(".classify .hover").attr('title');
        if (Istrue(type)) {
            paramObject.type = type;
        } else {

            paramObject.type = $(".classify .hover").attr('title');//POSTS帖子， USER用户， GROUP圈子， TREASURE藏品 *必填
        }
        paramObject.word = word; // 关键字
        mescroll.resetUpScroll();
        index++;
    }

    // 参数对象


    var paramObject = getParamObject();
    // 创建mescroll对象
    var mescroll = new MeScroll("mescroll", {
        up: {
            callback: upCallback, //上拉回调,此处可简写; 相当于 callback: function (page) { getListData(page); }
            isBounce: false, //此处禁止ios回弹,解析(务必认真阅读,特别是最后一点): http://www.mescroll.com/qa.html#q10
            //noMoreSize: 1,
            offset: 100,
            clearEmptyId: "dataList", //1.下拉刷新时会自动先清空此列表,再加入数据; 2.无任何数据时会在此列表自动提示空
            toTop: { //配置回到顶部按钮
                src: "../res/img/mescroll-totop.png" //默认滚动到1000px显示,可配置offset修改
            }
        }
    });

    //上拉加载的回调 page = {num:1, size:10}; num:当前页 默认从1开始, size:每页数据条数,默认10

    function upCallback(page) {
        paramObject.pageNumber = page.num; // 页码
        paramObject.pageSize = page.size; // 数量
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        if (Istrue(searchtype)) {
            $.ajax({
                url: link + "/manager/search/searchAll?" + $.param(paramObject),
                dataType: "Json",
                success: function (res) {
                    console.log(res);
                    handler({
                        res: res,
                        fun1: function () {
                            var curPageData = res.data; // 接口返回的当前页数据列表
                            var totalSize = res.count; // 接口返回的总数据量(比如列表有26个数据,每页10条,共3页; 则totalSize值为26)
                            mescroll.endBySize(curPageData.length, totalSize); // 联网成功的回调,隐藏下拉刷新和上拉加载的状态;
                            setListData(curPageData); // 设置列表数据
                        }
                    })
                },
                error: function (e) {
                    mescroll.endErr()
                }
            });
        }

    }

    // 设置列表数据
    function setListData(curPageData) {
        console.log(curPageData);
        console.log(searchtype);
        var str = "";
        for (var i = 0; i < curPageData.length; i++) {
            var pd = curPageData[i];
            let tex = '';
            let imgSrc = '';
            if (searchtype == 'POSTS' || searchtype == 'TREASURE' || searchtype == 'AUCTION') {//POSTS帖子， USER用户， GROUP圈子， TREASURE藏品 *必填
                imgSrc = pd.images.split(';')[0];
                tex = pd.title
            } else if (searchtype == 'USER') {
                imgSrc = pd.avatarPath;
                tex = pd.username
            } else if (searchtype == 'GROUP') {
                imgSrc = pd.smallImage;
                tex = pd.groupName
            }
            var imgList = imgSrc.split('.');
            var imgSr = link + imgList[0] + '.thumbnail.' + imgList[1];
            str += '<li>';
            console.log(searchtype);
            if (searchtype == 'POSTS' || searchtype == 'TREASURE') {//POSTS帖子， USER用户， GROUP圈子， TREASURE藏品 *必填
                str += '<li onclick="window.location.href=\'post_detail.html?postId=' + pd.postId + '\'"><div class="img_big"><img onload="imgHeight(this)" src="' + imgSr + '" onerror="src=\'img/img_default.png\'" alt=""/></div>'
            } else if (searchtype == 'USER') {
                str += '<li onclick="window.location.href=\'myHome.html?userId=' + pd.userId + '\'"><div class="img_big" style="width:100px;height:100px;"><img onload="imgHeight(this)" src="' + imgSr + '" onerror="src=\'img/img_default.png\'" alt=""/></div>'
            } else if (searchtype == 'GROUP') {
                str += '<li onclick="window.location.href=\'circleDetail.html?groupid=' + pd.groupId + '\'"><div class="img_big" style="width:200px;height:200px;"><img onload="imgHeight(this)" src="' + imgSr + '" onerror="src=\'img/img_default.png\'" alt=""/></div>'
            } else if (searchtype == 'AUCTION') {
                str += '<li onclick="window.location.href=\'productDetail.html?productId=' + pd.itemId + '\'"><div class="img_big"><img onload="imgHeight(this)" src="' + imgSr + '" onerror="src=\'img/img_default.png\'" alt=""/></div>'
            }
            str += '<div class="detail">' +
                '           <p class="name">' + tex + '</p>' +
                '       </div>' +
                '   </li>'
        }
        $(".hint_tex").hide();
        $("#mescroll").show();
        $("#dataList").append(str);

    }


    //清空搜索记录
    function close_history() {
        var paramObject = getParamObject();
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/manager/search/deleteSearch",
            type: "DELETE",
            data: paramObject,
            dataType: "Json",
            success: function (res) {
                handler({
                    res: res,
                    fun1: function () {
                        console.log(res);
                        $(".history li").text("");
                        $(".history li").remove();
                    }
                })
            },
            error: function (e) {
                mescroll.endErr()
            }
        })
    }
</script>
<script>
    //  	$("#search").focus()

    $(".delete").click(function () {
        $(".search_input").val("")
    });
    $(".hot_search ul li").click(function () {
        let txt = $(this).text();
        $(".search_input").val(txt)
    })

</script>
</body>

</html>
