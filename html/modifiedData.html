<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>修改资料</title>
    <meta content="width=device-width,target-densitydpi=device-dpi, user-scalable=0" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="true" name="HandheldFriendly"/>
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta content="模型APP内测招募" property="title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="image"/>

    <meta content="模型APP内测招募" property="og:title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="og:image"/>
    <script type="text/javascript">
        if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
            var version = parseFloat(RegExp.$1);
            if (version > 2.3) {
                var phoneScale = parseInt(window.screen.width) / 750;
                document.write('<meta name="viewport" content="width=750, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
            } else {
                document.write('<meta name="viewport" content="width=, target-densitydpi=device-dpi">');
            }
        } else {
            document.write('<meta name="viewport" content="width=750, user-scalable=no">');
        }
    </script>
    <link href="css/style.css" rel="stylesheet">
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>
    <link href="css/mtween.css" rel="stylesheet">

    <!-- 上传图片后方向不对调整 -->
    <script src="js/exif.js" type="text/javascript"></script>
    <link href="css/mtween.css" rel="stylesheet">


</head>
<body>
<div id="modified">


    <div class="content">
        <div class="head_box">
            <div id="result2"><img id="resultImg2" onerror="src='img/myhome/bg.jpg'" src="img/myhome/bg.jpg"></div>
            <div class="head_img" style="position: relative;">
                <!--上传头像DEMO-->
                <div id="result" style="position: absolute;left:0;top:0;width:100%;height:100%"><img id="resultImg"
                                                                                                     src="img/myhome/head_img.png"
                                                                                                     style="width: 100%;display:block;height: 100%;">
                </div>
                <div style="width:100%;height:100%;position: absolute;left:0;top:0;"><label id="lablel_1"
                                                                                            style="width:160px;height:160px;position: absolute;left:0;top:0;"><input
                        accept="image/*" id="file_1" name="file"
                        style="width:100%;height:100%;opacity:0;position: absolute;left:0;top:0;z-index: 1;"
                        type="file"></label></div>
            </div>
            <div style="width:136px;height:48px;position: absolute;left:307px;top:280px;font-size: 24px;color:white;text-align: center;line-height: 48px;background: rgba(255,255,255,0.5);border:1px solid #ffffff;border-radius: 24px;">
                修改封面<label id="lablel_2" style="width:136px;height:48px;position: absolute;left:0;top:0;"><input
                    accept="image/*" id="file_2" name="file"
                    style="width:100%;height:100%;opacity:0;position: absolute;left:0;top:0;z-index: 1;"
                    type="file"></label></div>
            <!-- <p class="text">点击上传头像</p> -->
        </div>
        <div class="mesg_box">
            <div class="box">
                <p class="title">昵称</p>
                <input class="realname" maxlength="20" placeholder="请输入您的用户名" type="text"/>
            </div>

            <div class="box">
                <p class="title">性别</p>
                <div class="select_box">
                    <p class="male hover" date-id="0">男</p>
                    <p class="women" date-id="1">女</p>
                </div>
            </div>

            <div class="box">
                <p class="title">城市</p>
                <div class="right">
                    <input class="input addr" id="address" maxlength="10" placeholder="请填写您的城市" type="text">
                </div>
                <!-- <input maxlength="10" class="addr" type="text" placeholder=""/> -->
            </div>

            <div class="box">
                <p class="title">身份</p>
                <p class="selectID"></p>
                <!--<input class="realname" type="text" placeholder="请输入您的昵称"/>-->
            </div>

            <p class="title">签名</p>
            <div class="box">

                <textarea class="mark_detail" cols="" maxlength="20" name="" placeholder="来写个签名，让别人更好的了解你吧！"
                          rows=""></textarea>
            </div>
            <button class="savebt" onclick="saveMsg()">保存</button>

        </div>
    </div>


    <div class="id_box">
        <div class="click"></div>
        <div class="big_box" style="position: absolute;left: 0;bottom: 0px;border-radius: 16px;background: white;">

            <div class="container">
                <div class="box pitch">
                    <p class="title">当前标签（<span>0</span>/3）</p>
                    <ul class="lable">
                    </ul>
                </div>

                <div class="select_box box">
                    <p class="title">分类1</p>
                    <ul class="lable lable0">
                    </ul>
                </div>

                <div class="select_box box">
                    <p class="title">分类2</p>
                    <ul class="lable lable1">
                    </ul>
                </div>

                <div class="select_box box">
                    <p class="title">分类3（需认证）</p>
                    <ul class="lable lable2">

                    </ul>
                </div>
                <p class="state">*最多可添加3个身份标签</p>
            </div>
            <div class="foot_botton">
                <button class="save">确认身份</button>
            </div>
        </div>
    </div>


    <div class="hint_box" style="bottom: 200px;">
        <p></p>
    </div>


</div>


<div class="page">
    <header><a class="btn" href="javascript:" id="saveBtn">保存</a></header>
    <div class="con">
        <canvas id="c" style="background: rgba(0,0,0,0.5);"></canvas>
        <div id="select">
            <span class="top"></span>
            <span class="right"></span>
            <span class="bottom"></span>
            <span class="left"></span>
            <span class="left-top"></span>
            <span class="left-bottom"></span>
            <span class="right-top"></span>
            <span class="right-bottom"></span>
        </div>
    </div>
</div>


<script src="js/common.js" type="text/javascript"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
<!--上传头像js-->
<script src="js/MTween.js" type="text/javascript"></script>
<script src="js/upload.js" type="text/javascript"></script>


<!-- <script type="text/javascript" src="city/data.js"></script> -->

<!-- <script type="text/javascript" src="js/exif.js"></script> -->

<script type="text/javascript">
    $(".id_box .big_box").css({'height': $(window).height() - 200});
    $(".id_box .big_box .container").css({'height': $(window).height() - 300});
    $(".content").click(function () {
        // alert(222222222)
    });
    $(".id_box").click(function () {
        // alert(222222222)
    });
    shareMsg(); //分享

    $(".content").css({'min-height': $(window).height()});
    var userId = getQueryStringByName('userId');
    getOneSocial(userId);//获取用户信息
    function inhtml(pd) { //用户信息填充
        console.log(pd);
        $("#result img").attr("src", link + pd.avatarPath);
        if (Istrue(pd.backGroundPath)) {
            $("#result2 img").attr("src", link + pd.backGroundPath)
        }

        $(".realname").val(pd.username);
        if (pd.sex == false) {
            $(".select_box p").removeClass("hover");
            $(".select_box .male").addClass("hover")
        } else {
            $(".select_box p").removeClass("hover");
            $(".select_box .women").addClass("hover")
        }
        $(".addr").val(pd.domain);
        $(".mark_detail").val(pd.signature)
    }


    getCareerList();

    //获取所有用户职业
    function getCareerList() {
        var paramObject = getParamObject();
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/manager/career/getCareerList?" + $.param(paramObject),
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        for (var i = 0; i < res.data.length; i++) {
                            var pd = res.data[i];
                            $(".select_box .lable" + pd.careerCertLevel).append('<li data="' + pd.careerId + '">' + pd.careerName + '</li>')
                        }
                        selectCareerLis();
                    }
                })
            },
            error: function (e) {

            }
        });
    }

    function selectCareerLis() {
        var numb = 0;
        $(".select_box li").click(function () {
            let index = $(".select_box .current").length;
            if (!$(this).hasClass("current")) {
                console.log(index);
                if (index < 3) {
                    $(".pitch .title span").text(parseInt(index) + 1);
                    numb = $(this).attr("data");
                    let result = "";
                    $(this).addClass("current");
                    var txt = $(this).text();
                    result = "<li class='li" + numb + "' data_id='" + numb + "'>" + txt + "</li>";
                    $(".pitch .lable").append(result)
                } else {
                    alert("最多可选三个身份")
                }
            } else {
                $(this).removeClass("current");
                $(".pitch .title span").text(parseInt(index) - 1);
                let data = $(this).attr("data");
                $(".pitch .lable .li" + data).remove()
            }
        });
    }


    //修改用户职业
    function updateUserCareer(FirstId, SecondId, ThirdId) {
        var paramObject = getParamObject();
        paramObject.careerFirstId = FirstId; // 第一职业Id
        if (Istrue(SecondId)) {
            paramObject.careerSecondId = SecondId; // 第二职业Id
        } else {
            paramObject.careerSecondId = ' '; // 第二职业Id
        }
        if (Istrue(ThirdId)) {
            paramObject.careerThirdId = ThirdId; // 第三职业Id
        } else {
            paramObject.careerThirdId = ' '; // 第三职业Id
        }
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/user/user/updateUserCareer",
            type: 'POST',
            data: paramObject,
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        $(".id_box").hide();
                        getUserCareer(userId)
                    }
                })
            },
            error: function (e) {

            }
        });
    }

    $(".foot_botton .save").click(function () {
        let ArrId = [];
        let len = $(".pitch li").length;
        if (len > 0) {
            for (var i = 0; i < len; i++) {
                let data_id = $(".pitch li").eq(i).attr("data_id");
                ArrId.push(data_id)
            }
            updateUserCareer(ArrId[0], ArrId[1], ArrId[2])
        }
    });


    //获取用户职业标签
    getUserCareer(userId)


</script>
<script>
    $(".click").click(function () {
        $(this).parent().fadeOut(200)
    });

    $(".head .close").click(function () {
        $(".id_box").hide();
    });

    $(".selectID").click(function () {
        // alert('click')
        $(".id_box").show();
    });

    $(".select_box p").click(function () {
        $(".select_box p").removeClass("hover");
        $(this).addClass("hover")
    });

    //修改个人信息
    function saveMsg() {
        if ($(".realname").val() == "") {
            let text = "请输入用户名";
            hint(text);
            return false;
        }
        var paramObject = getParamObject();
        paramObject.username = $(".realname").val(); // 用户名
        paramObject.sex = $(".select_box .hover").attr("date-id"); // 性别
        paramObject.domain = $(".addr").val(); // 据点
        paramObject.signature = $(".mark_detail").val(); // 签名
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/user/user/updateUserInfo",
            data: paramObject,
            type: "POST",
            dataType: "json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        window.location.href = "myHome.html"
                    }
                })
            },
        })
    }

</script>

<script type="text/javascript">


    //上传头像
    function sumitImageFile(base64Codes) {
        // alert(base64Codes)
        var formData = new FormData();   //这里连带form里的其他参数也一起提交了,如果不需要提交其他参数可以直接FormData无参数的构造函数
//			    formData.append("avatarFile", dataURLtoFile(base64Codes, "1.png"));
        // alert(base64toFile(base64Codes,name))
        formData.append("avatarFile", base64toFile(base64Codes));
        formData.append("timestamp", new Date().getTime());
        formData.append("requestId", 'd79b9efa995f');
        var data = formData;
        $.ajax({
            url: link + "/user/user/updateAvatar",
            data: data,
            type: "POST",
            dataType: "json",
            processData: false,//用于对data参数进行序列化处理 这里必须false
            contentType: false, //必须
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        //              	window.location.href="myHome.html"
                    }
                })
            },
        })
    }

    //上传封面
    function updateBackGround(base64Codes) {
        var formData = new FormData();   //这里连带form里的其他参数也一起提交了,如果不需要提交其他参数可以直接FormData无参数的构造函数
//			    formData.append("avatarFile", dataURLtoFile(base64Codes, "1.png"));
        formData.append("backGroundFile", base64toFile(base64Codes));
        formData.append("timestamp", new Date().getTime());
        formData.append("requestId", 'd79b9efa995f');
        var data = formData;
        $.ajax({
            url: link + "/user/user/updateBackGround",
            data: data,
            type: "POST",
            dataType: "json",
            processData: false,//用于对data参数进行序列化处理 这里必须false
            contentType: false, //必须
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        //              	window.location.href="myHome.html"
                    }
                })
            },
        })
    }
</script>


</body>
</html>