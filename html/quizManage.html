<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>提问管理</title>
    <meta content="width=device-width,target-densitydpi=device-dpi, user-scalable=0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="true" name="HandheldFriendly">
    <meta content="yes" name="apple-touch-fullscreen">
    <link href="mescroll/mescroll.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <meta content="模型APP内测招募" property="title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="image"/>

    <meta content="模型APP内测招募" property="og:title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="og:image"/>
    <style type="text/css">
        .hintTex {
            width: 100%;
            overflow: hidden;
        }

        .hintTex .img {
            width: 100%;
            margin-top: 200px;
            text-align: center;
        }

        .hintTex p {
            font-size: 28px;
            color: #1C2027;
            text-align: center;
            margin-top: 30px;
        }
    </style>
    <script type="text/javascript">
        if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
            let version = parseFloat(RegExp.$1);
            if (version > 2.3) {
                let phoneScale = window.screen.width / 750;
                document.write('<meta name="viewport" content="width=750, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
            } else {
                document.write('<meta name="viewport" content="width=, target-densitydpi=device-dpi">');
            }
        } else {
            document.write('<meta name="viewport" content="width=750, user-scalable=no">');
        }
    </script>
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>
</head>
<body>
<div id="quizManage">
    <div id="content">
        <div class="mescroll" id="mescroll">
            <ul id="dataList">

            </ul>
            <script id="questionTpl" type="text/html">
                <li class="li{{questionId}}">
                    <div class="head_box">
                        <div class="head">
                            <img src="{{avatarPath}}" alt="">
                        </div>
                        <p class="name">{{username}}</p>
                    </div>
                    <div class="msg">
                        <p class="text">
                            <img src="img/detail/ico_ask.png " alt="">
                            <span>{{problem}}</span>
                        </p>
                        {{if answer}}
                        <p class="text">
                            <img src="img/detail/ico_answer.png " alt="">
                            <span>{{answer}}</span>
                        </p>
                        {{/if}}
                        <div class="time">
                            <span>{{createTime}}</span>
                        </div>
                    </div>
                    {{if !answer}}
                    <div class="reply">
                        <textarea class="textarea" maxlength="45" placeholder="回复内容限45个字！">回复</textarea>
                        <button class="replybt" onclick="reply('{{questionId}}')">回复</button>
                    </div>
                    {{/if}}
                </li>
            </script>
        </div>
    </div>
</div>

<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js" type="text/javascript"></script>
<script src="mescroll/mescroll.min.js" type="text/javascript"></script>
<script src="js/template.js" type="text/javascript"></script>
<script src="js/common.js" type="text/javascript"></script>
<script type="text/javascript">
    shareMsg(); //分享


    // 设置高度
    $("#content").height($(window).height());

    // 创建mescroll对象
    let mescroll = new MeScroll("mescroll", {
        up: {
            callback: upCallback,
            isBounce: false,
            offset: 100,
            clearEmptyId: "dataList",
            toTop: {
                src: "../res/img/mescroll-totop.png"
            }
        }
    });
    // 请求数据
    let requestData = {
        auctionId: getQueryStringByName("productId")
    };

    /**
     * 上拉加载的回调
     * @param page 分页信息
     */
    function upCallback(page) {
        requestData.pageNumber = page.num;
        requestData.pageSize = page.size;
        requestData.requestId = md5($.param(requestData));
        requestData.timestamp = new Date().getTime();

        $.ajax({
            url: link + '/goods/questions',
            type: 'GET',
            data: requestData
        }).done(function (response) {
            console.log(response);

            handler({
                res: response,
                fun1: function () {
                    let curPageData = response.data;

                    mescroll.endBySize(curPageData.length, response.count);
                    setListData(curPageData);
                }
            });
        });
    }

    /**
     * 设置列表数据
     * @param curPageData
     */
    function setListData(curPageData) {
        let length = curPageData.length;

        if (length === 0) {
            $("#dataList").html('<div class="hintTex"><div class="img"><img src="res/img/mescroll-empty.png" alt=""></div><p>暂无买家提问</p></div>');
            return;
        }

        let dataListHTML = '';
        for (let i = 0; i < length; i++) {
            let tplData = curPageData[i];
            tplData.avatarPath = link + tplData.avatarPath;

            dataListHTML += template('questionTpl', tplData);
        }

        $("#dataList").html(dataListHTML);

        $(".textarea").focus(function () {
            $(".textarea").css({"height": "30px", "width": "55px"});
            $(".textarea").parent().removeClass("text-on");
            $(".textarea").val("回复");

            $(this).css({"height": "90px", "width": "642px"});
            $(this).parent().addClass("text-on");
            $(this).val("");
        });
    }

    /**
     * 回复
     * @param questionId 提问ID
     */
    function reply(questionId) {
        let answer = $(".li" + questionId).find(".textarea").val();
        if (answer === '') {
            return hint('请输入回复内容');
        }

        $.ajax({
            url: link + '/goods/questions/' + questionId,
            type: 'PUT',
            data: {
                requestId: md5(JSON.stringify({questionId: questionId, answer: answer})),
                timestamp: new Date().getTime(),
                answer: answer
            }
        }).done(function (response) {
            console.log(response);

            handler({
                res: response,
                fun1: function () {
                    // 重置列表数据
                    mescroll.resetUpScroll();
                }
            })
        });
    }
</script>
</body>
</html>