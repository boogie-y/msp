<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="true" name="HandheldFriendly">
    <meta content="yes" name="apple-touch-fullscreen">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="width=device-width,target-densitydpi=device-dpi, user-scalable=0" name="viewport">
    <title>地址管理</title>
    <link href="css/style.css" rel="stylesheet">
    <meta content="模型APP内测招募" property="title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="image"/>

    <meta content="模型APP内测招募" property="og:title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="og:image"/>

    <script type="text/javascript">
        if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
            let version = parseFloat(RegExp.$1);
            if (version > 2.3) {
                let phoneScale = window.screen.width / 750;
                document.write('<meta name="viewport" content="width=750, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
            } else {
                document.write('<meta name="viewport" content="width=, target-densitydpi=device-dpi">');
            }
        } else {
            document.write('<meta name="viewport" content="width=750, user-scalable=no">');
        }
    </script>
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>
</head>
<body>
<div id="myAddr">

    <div class="content">
        <ul class="addList">
            <!--<li class="default">
                <div class="msg_box">
                    <div class="msg">
                        <p class="name">张三李四</p>
                        <p class="number">15221120951</p>
                        <p class="moren">默认</p>
                    </div>
                    <p class="addr">上海市静安区XXX路XXX支路XXX弄XXX号</p>
                </div>
                <a href="addRedact.html" class="compilebt"></a>
            </li>-->
        </ul>

        <div class="foot_botton">
            <a class="addAddr" href="addRedact.html">新增收货地址</a>
        </div>

        <div class="foot_botton2">
            <button class="deleteAddr">删除</button>
            <button class="saveAddr">保存</button>
        </div>
    </div>

</div>

<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js" type="text/javascript"></script>
<script src="js/common.js" type="text/javascript"></script>
<script type="text/javascript">
    shareMsg(); //分享


    let orderId = getQueryStringByName("orderId");

    // 获取地址列表
    getAddressList();

    /**
     * 获取地址列表
     */
    function getAddressList() {
        $.ajax({
            url: link + '/user/user-addr/getMyAddressList',
            type: 'GET',
            data: {
                requestId: md5('getMyAddressList'),
                timestamp: new Date().getTime()
            }
        }).done(function (response) {
            console.log(response);

            handler({
                res: response,
                fun1: function () {
                    let list = response.data;

                    let addListHTML = '';
                    for (let i = 0; i < list.length; i++) {
                        addListHTML += '<li>';
                        addListHTML += '    <div class="msg_box" data-id="' + list[i].addrId + '">';
                        addListHTML += '        <div class="msg">';
                        addListHTML += '            <p class="name">' + list[i].fullName + '</p>';
                        addListHTML += '            <p class="number">' + list[i].mobile + '</p>';
                        addListHTML += '            ' + (list[i].default ? '<p class="moren">默认</p>' : '');
                        addListHTML += '        </div>';
                        addListHTML += '        <p class="addr">' + list[i].country + list[i].province + list[i].city + list[i].district + list[i].contactAddr + '</p>';
                        addListHTML += '    </div>';
                        addListHTML += '    <a href="addRedact.html?addrId=' + list[i].addrId + '" class="compilebt"></a>';
                        addListHTML += '</li>';
                    }

                    if ('' === addListHTML) {
                        addListHTML = '<p class="text">暂未添加地址</p>';
                    }
                    $('.addList').html(addListHTML);
                }
            })
        })
    }

    $('.addList').on('click', '.msg_box', function () {
        let addrId = $(this).data('id');

        if ('' === orderId) {
            location.href = 'addRedact.html?addrId=' + addrId;
        } else {
            // 修改订单收货地址
            modifyReceivingAddress(addrId);
        }
    });

    /**
     * 修改订单收货地址
     * @param addrId 地址ID
     */
    function modifyReceivingAddress(addrId) {
        $.ajax({
            url: link + '/order/orders/' + orderId + '/deliverAddress',
            type: 'PUT',
            data: {
                requestId: md5(orderId + addrId),
                timestamp: new Date().getTime(),
                addressId: addrId
            }
        }).done(function (response) {
            console.log(response);

            handler({
                res: response,
                fun1: function () {
                    location.replace('buyer_noPayment.html?orderId=' + orderId);
                }
            })
        })
    }
</script>
</body>
</html>