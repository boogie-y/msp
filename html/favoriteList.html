<html lang="en">
<head>
    <meta charset="utf-8">
    <title>藏品管理</title>
    <meta content="width=device-width,target-densitydpi=device-dpi, user-scalable=0" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="true" name="HandheldFriendly"/>
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta content="模型APP内测招募" property="title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="image"/>

    <meta content="模型APP内测招募" property="og:title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="og:image"/>
    <script type="text/javascript">
        if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
            var version = parseFloat(RegExp.$1);
            if (version > 2.3) {
                var phoneScale = parseInt(window.screen.width) / 750;
                document.write('<meta name="viewport" content="width=750, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
            } else {
                document.write('<meta name="viewport" content="width=, target-densitydpi=device-dpi">');
            }
        } else {
            document.write('<meta name="viewport" content="width=750, user-scalable=no">');
        }
    </script>
    <link href="css/style.css" rel="stylesheet">
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>

</head>
<body>
<div id="favoriteList">
    <div class="head">
        <div class="back" onclick="window.location.href='favorite.html'"></div>
        <p class="title">展示位（<span>0/9</span>）</p>
    </div>
    <div class="content">

        <ul class="showList part">


        </ul>
        <div class="add_box">
            <img src="img/favorite/ico_add.png">
            <p>添加藏品</p>
        </div>
    </div>


    <div class="object_box">
        <div class="head_title">
            <div class="back"></div>
            <p class="title">添加藏品</p>
        </div>
        <div class="over_box" style="overflow: auto;">
            <ul>
                <!--<li class=""><img src="img/favorite/img.png"><div class="select"></div></li>
                <li class=""><img src="img/favorite/img.png"><div class="select"></div></li>-->
            </ul>
        </div>

    </div>

    <div class="hint_box">
        <p></p>
    </div>

    <!--确认提示框-->
    <div class="hint_box2">
        <div class="click"></div>
        <div class="box">
            <p class="title"></p>
            <p class="text">确定要下架该藏品吗？</p>
            <div class="bt">
                <button onclick="closeHint();">手滑了</button>
                <button class="affirm">确定</button>
            </div>
        </div>
    </div>

</div>

<script src="js/common.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>

<script>
    $(".over_box").css({'height': $(window).height() - 86});
    shareMsg(); //分享
    getList('SHOWING');
    getList('DISSHOW');


    var oldTreasureId = '';


    //获取藏品列表
    function getList(siteType) {
        var paramObject = getParamObject();
        paramObject.siteType = siteType; // 请求时间戳
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/goods/treasure/getList?" + $.param(paramObject),
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        var currenList = res.data;
                        if (siteType == 'SHOWING')
                            showList(currenList);
                        else
                            disShowList(currenList)
                    }
                })
            },
            error: function (e) {

            }
        });
    }


    function showList(currenHtml) {
        console.log(currenHtml);
        var str = '';
        $(".head .title span").text(currenHtml.length + "/9");
        if (currenHtml.length == 9) {
            $(".add_box").hide();
        } else {
            $(".add_box").show();
        }
        for (var i = 0; i < currenHtml.length; i++) {
            let pd = currenHtml[i];
            var imgArr = [];
            if (Istrue(pd.images)) {
                imgArr = pd.images.split(";");
            }

            let postText = '';
            if (pd.title.length > 10) {
                postText = pd.title.substring(0, 10) + '...'
            } else {
                postText = pd.title
            }
            console.log(pd.site);

            str += '<li>' +
                '<div  class="img_big">' + compressPicture("0", imgArr[0]) + '</div>' +
                '<div class="detail">' +
                '<p class="name">' + postText + '</p>' +
                '<div class="number">' +
                '<p class="num1">' + pd.masterGood + '</p>' +
                '<p class="num2">' + pd.citizenGood + '</p>' +
                '<p class="num3">' + pd.peopleGood + '</p>' +
                '</div>' +
                '<div class="bt_box">' +
                '<button onclick="replace(\'' + pd.treasureId + '\')">替换</button>' +
                '<button onclick="hint2(\'' + pd.treasureId + '\')">下架</button>' +
                '<button class="up" onclick="moveUp(\'' + pd.treasureId + '\')">上移</button>' +
                '<button class="down" onclick="moveDown(\'' + pd.treasureId + '\')" style="margin:0">下移</button>' +
                '</div>' +
                '</div>' +
                '</li>'
        }
        console.log(str);
        $(".showList").html(str);
        $(".showList").children(':first-child').find('.up').addClass('hover');
        $(".showList").children(':first-child').find('.up').attr("disabled", "disabled");
        $(".showList").children(':last-child').find('.down').addClass('hover');
        $(".showList").children(':last-child').find('.down').attr("disabled", "disabled")

    }

    function disShowList(currenHtml) {
        console.log(currenHtml);
        var str = '';
        if (currenHtml.length > 0) {
            for (var i = 0; i < currenHtml.length; i++) {
                let pd = currenHtml[i];
                var imgArr = [];
                if (Istrue(pd.images)) {
                    imgArr = pd.images.split(";");
                    str += '<li data_id="' + pd.treasureId + '">' + compressPicture("0", imgArr[0]) + '<div class="select"></div></li>'
                } else {
                    str += '<li data_id="' + pd.treasureId + '">' + compressPicture("0", imgArr[0]) + '<div class="select"></div></li>'
                }
            }
        } else {
            str += '<p>所有的藏品已上架</p>'
        }
        $(".object_box ul").html(str);
        $(".object_box li").click(function () {
            $(".object_box li").removeClass("hover");
            $(this).addClass("hover");
            let id = $(this).attr("data_id");
            if (oldTreasureId == "") {

                addTreasure(id)
            } else {
                replaceTreasure(id)
            }
        })
    }


    //			添加藏品
    function addTreasure(treasureId) {
        var paramObject = getParamObject();
        paramObject.treasureId = treasureId; // 藏品ID
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/social/cabinet/addTreasure",
            type: 'POST',
            data: paramObject,
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        location.reload()
                    }
                })
            },
            error: function (e) {

            }
        });
    }

    //二次确认框
    function hint2(treas) {
        $(".hint_box2").show();
        $(".hint_box2 .affirm").click(function () {
            soldOut(treas)
        })
    }

    //下架藏品
    function soldOut(treasureId) {
        var paramObject = getParamObject();
        paramObject.treasureId = treasureId; // 请求时间戳
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/social/cabinet/removeTreasure",
            type: 'POST',
            data: paramObject,
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        location.reload()
                    }
                })
            },
            error: function (e) {

            }
        });
    }

    //上移藏品
    function moveUp(treasureId) {
        var paramObject = getParamObject();
        paramObject.treasureId = treasureId; // 请求时间戳
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/social/cabinet/upTreasure",
            type: 'POST',
            data: paramObject,
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        location.reload()
                    }
                })
            },
            error: function (e) {

            }
        });
    }

    //下移藏品
    function moveDown(treasureId) {
        var paramObject = getParamObject();
        paramObject.treasureId = treasureId; // 请求时间戳
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/social/cabinet/downTreasure",
            type: 'POST',
            data: paramObject,
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        location.reload()
                    }
                })
            },
            error: function (e) {

            }
        });
    }


    function replace(TreasureId) {
        oldTreasureId = TreasureId;
        $(".object_box").show();
    }

    //替换藏品
    function replaceTreasure(treasureId) {
        var paramObject = getParamObject();
        paramObject.newTreasureId = treasureId; // 新的ID
        paramObject.oldTreasureId = oldTreasureId; // 老的ID
        paramObject.timestamp = new Date().getTime(); // 请求时间戳
        paramObject.requestId = md5($.param(paramObject)); // 请求ID
        $.ajax({
            url: link + "/social/cabinet/replaceTreasure",
            type: 'POST',
            data: paramObject,
            dataType: "Json",
            success: function (res) {
                console.log(res);
                handler({
                    res: res,
                    fun1: function () {
                        location.reload()
                    }
                })
            },
            error: function (e) {

            }
        });
    }


    $(".add_box").click(function () {
        $(".object_box").show();
    });
    $(".object_box .back").click(function () {
        oldTreasureId = '';
        $(".object_box").hide();
    })


</script>
</body>
</html>