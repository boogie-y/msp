<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>身份认证</title>
    <meta content="width=device-width,target-densitydpi=device-dpi, user-scalable=0" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="true" name="HandheldFriendly"/>
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta content="模型APP内测招募" property="title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="image"/>

    <meta content="模型APP内测招募" property="og:title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="og:image"/>
    <script type="text/javascript">
        if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
            var version = parseFloat(RegExp.$1);
            if (version > 2.3) {
                var phoneScale = parseInt(window.screen.width) / 750;
                document.write('<meta name="viewport" content="width=750, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
            } else {
                document.write('<meta name="viewport" content="width=, target-densitydpi=device-dpi">');
            }
        } else {
            document.write('<meta name="viewport" content="width=750, user-scalable=no">');
        }
    </script>
    <link href="css/style.css" rel="stylesheet">
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>


</head>
<body>
<div id="attestat">

    <div class="content">
        <div class="msg_box">
            <div class="input_box">
                <p class="tex">真实姓名</p>
                <input class="rename" maxlength="15" type="text"/>
            </div>
            <div class="input_box">
                <p class="tex">身份证号</p>
                <input class="cardId" maxlength="18" type="text"/>
            </div>
            <div class="input_box">
                <p class="tex">联系地址</p>
                <select class="province" id="province_select" name="province"></select>
                <select class="city" id="city_select" name="city"></select>
            </div>
            <input autocomplete="off" class="county" maxlength="100" placeholder="详细地址" type="text">
        </div>
        <div class="upload_box">
            <p class="txt">上传照片</p>
            <div class="upload1 upload">
                <img alt="" src="img/issue/card_img1.png"/>
                <input id="fil" type="file"/>
            </div>
            <div class="upload2 upload">
                <img alt="" src="img/issue/card_img2.png"/>
                <input id="fil2" type="file"/>
            </div>
        </div>
        <button class="submit" onclick="submitbt()">提交信息</button>


    </div>

    <div class="hint_box">
        <p></p>
    </div>


    <script src="js/city.js" type="text/javascript"></script>
    <script src="js/common.js" type="text/javascript"></script>
    <script type="text/javascript">
        shareMsg(); //分享

        $("#fil").bind('change', upload);
        $("#fil2").bind('change', upload);
        var _url = [];

        function upload() {
            var fordate = new FormData(); //得到一个FormData对象：

            //		var fils = $("#fil").get(0).files[0]; //得到file对象
            var fils = this.files[0]; //得到file对象

            fordate.append('pic', fils); //用append方法添加键值对
            console.log(fils);
            var srcc = window.URL.createObjectURL(fils); //传入的参数创建一个指向该参数对象的URL
            console.log(fordate);
            console.log(this.id);
            var id = this.id;
            var input = document.getElementById(id);
            if (!input['value'].match(/.jpg|.gif|.png|.jpeg|.bmp/i)) {　　 //判断上传文件格式
                return alert("上传的图片格式不正确，请重新选择");
            }
            $("#" + id).prev().attr("src", srcc); //img标签插入blod图片源
            //转换成base64
            var reader = new FileReader();
            reader.onload = function (fileEvent) {

                base64 = fileEvent.target.result;
                console.log(id);
                if (id == "fil") {
                    _url[0] = base64
                } else {
                    _url[1] = base64
                }
                console.log(base64);
                console.log(_url)
                //		    $("#"+id).prev().attr("src",base64);//img标签插入base64图片源
                //		    console.log(base64)

            };
            reader.readAsDataURL(fils)

        }

        function submitbt() {
            let text;
            var code = $("cardId").val();
            if ($(".rename").val() == "") {
                text = "请填写姓名";
                hint(text);
                return false;
            }

            //		IdentityCodeValid(code)
            //身份证验证
            var city = {
                11: "北京",
                12: "天津",
                13: "河北",
                14: "山西",
                15: "内蒙古",
                21: "辽宁",
                22: "吉林",
                23: "黑龙江 ",
                31: "上海",
                32: "江苏",
                33: "浙江",
                34: "安徽",
                35: "福建",
                36: "江西",
                37: "山东",
                41: "河南",
                42: "湖北 ",
                43: "湖南",
                44: "广东",
                45: "广西",
                46: "海南",
                50: "重庆",
                51: "四川",
                52: "贵州",
                53: "云南",
                54: "西藏 ",
                61: "陕西",
                62: "甘肃",
                63: "青海",
                64: "宁夏",
                65: "新疆",
                71: "台湾",
                81: "香港",
                82: "澳门",
                91: "国外 "
            };
            var tip = "";
            var pass = true;
            if (!code || !/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}(\d|X|x)$/i.test(code)) {
                tip = "身份证号格式错误";
                pass = false;
            } else if (!city[code.substr(0, 2)]) {
                tip = "地址编码错误";
                pass = false;
            } else {
                //		18位身份证需要验证最后一位校验位
                if (code.length == 18) {
                    code = code.split('');
                    //∑(ai×Wi)(mod 11)
                    //加权因子
                    var factor = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];         //校验位
                    var parity = [1, 0, 'X', 9, 8, 7, 6, 5, 4, 3, 2];
                    var sum = 0;
                    var ai = 0;
                    var wi = 0;
                    for (var i = 0; i < 17; i++) {
                        ai = code[i];
                        wi = factor[i];
                        sum += ai * wi;
                    }
                    var last = parity[sum % 11];         //最后一位不区分大小写
                    if (code[17] == 'x') code[17] = code[17].toUpperCase();
                    console.log(parity[sum % 11]);
                    console.log(last);
                    console.log(code[17]);
                    if (parity[sum % 11] != code[17]) {
                        tip = "校验位错误";
                        pass = false;
                    }
                }
            }
            hint(tip);
            return {'status': pass, 'msg': tip};
            return pass;


            if ($(".province").val() == "" || $(".province").val() == "省份") {
                text = "请选择省份";
                hint(text);
                return false;
            }

            if ($(".city").val() == "" || $(".city").val() == "城市") {
                text = "请选择城市";
                hint(text);
                return false;
            }

            if ($(".county").val() == "") {
                text = "请填写地址";
                hint(text);
                return false;
            }
            if (_url.length < 2) {
                text = "请上传证件照";
                hint(text);
                return false;
            }
            console.log(_url);

            $.ajax({ //发送ajax请求
                url: "index4.php",
                type: "post",
                data: base64,
                processData: false,
                contentType: false,
                success: function (html) {
                    console.log(html);
                }
            });
        }

    </script>


</div>

<script>

    init('province_select', 'city_select');
    select();

    $("select").change(function () {
        if ($(this).hasClass("province")) {
            $("#city_select").val("");
            select();
        }
    });


</script>
</body>
</html>