<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>出价记录</title>
    <meta content="width=device-width,target-densitydpi=device-dpi, user-scalable=0" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="true" name="HandheldFriendly"/>
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta content="模型APP内测招募" property="title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="image"/>

    <meta content="模型APP内测招募" property="og:title"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:description"/>
    <meta content="最强最走心的模型APP登场！去模型圈大佬面对面交流，晒单拍卖无缝连接。" property="og:keywords"/>
    <meta content="https://www.2501p.com/img/share_logo.jpg" property="og:image"/>
    <script type="text/javascript">
        if (/Android (\d+\.\d+)/.test(navigator.userAgent)) {
            var version = parseFloat(RegExp.$1);
            if (version > 2.3) {
                var phoneScale = parseInt(window.screen.width) / 750;
                document.write('<meta name="viewport" content="width=750, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">');
            } else {
                document.write('<meta name="viewport" content="width=, target-densitydpi=device-dpi">');
            }
        } else {
            document.write('<meta name="viewport" content="width=750, user-scalable=no">');
        }
    </script>
    <link href="css/style.css" rel="stylesheet">
    <script src="js/jquery-3.4.1.min.js" type="text/javascript"></script>


    <link href="mescroll/mescroll.min.css" rel="stylesheet"></link>
    <style type="text/css">

        /*ios使用sticky样式实现*/
        .nav-sticky {
            /*height: 179px;*/
            z-index: 9999; /*需设置zIndex,避免在悬停时,可能会被列表数据遮住*/
            position: -webkit-sticky;
            position: sticky;
            top: 0; /*相对mescroll的div悬停的位置*/
        }

        .nav-sticky:before #fixation_menu {
            display: block;
        }

        /*android和pc端悬停*/
        .nav-fixed {
            z-index: 9999;
            position: fixed;
            top: 87px;
            left: 0;
            width: 100%;
        }

        .nav-fixed #fixation_menu {
            display: block;
        }

        /*列表*/
        .mescroll {
            position: fixed;
            top: 0px;
            bottom: 0px;
            width: 100%;
            height: auto;
        }

        /*展示上拉加载的数据列表*/
        .data-list li {
            position: relative;
            /*padding: 10px 8px 10px 120px;*/
            border-bottom: 1px solid #eee;
        }

        .data-list .pd-img {
            position: absolute;
            left: 18px;
            top: 18px;
            width: 80px;
            height: 80px;
        }

        .data-list .pd-name {
            font-size: 16px;
            line-height: 20px;
            height: 40px;
            overflow: hidden;
        }

        .data-list .pd-price {
            margin-top: 8px;
            color: red;
        }

        .data-list .pd-sold {
            font-size: 12px;
            margin-top: 8px;
            color: gray;
        }
    </style>


</head>
<body>
<div id="bidDetail">


    <div id="content">


        <div class="mescroll" id="mescroll">
            <!--模拟的轮播-->
            <div class="myDatum">
                <div class="basicMsg">
                    <div style="overflow: hidden;">
                        <div class="img"><img class="imgwidth" src=""></div>
                        <div class="txt_box">
                            <p class="name"></p>
                            <p class="text"></p>
                        </div>
                    </div>
                    <div class="msg">
                        <p class="peonumber">出价人数<span>0</span></p>
                        <p class="frequency">出价次数<span>0</span></p>
                        <p class="time time_box">剩余时间<span class="data">00</span>天<span class="hour">00</span>时<span
                                class="min">00</span>分<span class="sec">00</span>秒
                        </p>
                    </div>
                </div>
                <div class="line"></div>
            </div>
            <!--
                悬浮菜单:
                1.ios的悬停效果,通过给navWarp添加sticky样式来实现
                2.android和pc端悬停效果,通过监听mescroll的scroll事件,控制navContent是否为fixed定位来实现
            -->
            <div id="navWarp">

            </div>
            <div id="upscrollWarp">
                <div class="bidMsg" id="dataList">

                </div>
            </div>
        </div>
        <!--<div class="bidMsg">
            <ul>
                <li>
                    <div class="zhongbiao"></div>
                    <div class="head"><img src="img/detail/head_img.png"></div>
                    <div class="use_box">
                        <p class="name">呆毛王阿尔托莉雅</p>
                        <div class="evaluateMsg">
                            <p class="evaluateNum">评价 <span>9999</span></p>
                            <p class="general">好评率 <span>99</span>%</p>
                        </div>
                    </div>
                    <p class="price">￥<span>999</span></p>
                </li>
                <p class="text">留言留言留言留言留言留言留言留言留言留言留言留言留言留言留言留言留言留言留言留言留言留言留言留言...</p>
                <div class="time">
                    <span>2019-05-12</span>
                    <span>22:25:35</span>
                </div>
            </ul>

        </div>-->
    </div>


</div>


<script src="js/common.js"></script>
<!--上拉加载文件-->

<script charset="utf-8" src="mescroll/mescroll.min.js"></script>
<!--上拉刷新下拉加载-->
<script type="text/javascript">
    shareMsg(); //分享

    $("#content").height($(window).height());
    //			var cateId = getQueryStringByName("id");
    var productId = getQueryStringByName("productId");
    var orderBy = "composite_index";

    var mescroll = new MeScroll("mescroll", {
        up: {
            callback: upCallback, //上拉回调,此处可简写; 相当于 callback: function (page, mescroll) { getListData(page); }
            isBounce: false, //此处禁止ios回弹,解析(务必认真阅读,特别是最后一点): http://www.mescroll.com/qa.html#q10
            noMoreSize: 1,
            clearEmptyId: "dataList", //相当于同时设置了clearId和empty.warpId; 简化写法;默认null; 注意vue中不能配置此项
            warpId: "upscrollWarp", //让上拉进度装到upscrollWarp里面
            lazyLoad: {
                use: true // 是否开启懒加载,默认false
            },
            toTop: { //配置回到顶部按钮
                src: "../res/img/mescroll-totop.png" //默认滚动到1000px显示,可配置offset修改
            }
        }
    });


    //下拉后吸顶悬浮距离计算
    var navWarp = document.getElementById("navWarp");
    console.log(mescroll.os.ios);
    if (mescroll.os.ios) {
        //ios的悬停效果,通过给navWarp添加nav-sticky样式来实现
        navWarp.classList.add("nav-sticky");
    } else {
        //android和pc端悬停效果,通过监听mescroll的scroll事件,控制navContent是否为fixed定位来实现
        navWarp.style.height = navWarp.offsetHeight + "px";//固定高度占位,避免悬浮时列表抖动
        var navContent = document.getElementById("navContent");
        mescroll.optUp.onScroll = function (mescroll, y, isUp) {
//					console.log("up --> onScroll 列表当前滚动的距离 y = " + y + ", 是否向上滑动 isUp = " + isUp);
            if (y >= navWarp.offsetTop - 88) {
                navContent.classList.add("nav-fixed");
            } else {
                navContent.classList.remove("nav-fixed");
            }
        }
    }

    //上拉加载的回调 page = {num:1, size:10}; num:当前页 默认从1开始, size:每页数据条数,默认10
    function upCallback(page) {
        var pageNum = page.num; // 页码, 默认从1开始 如何修改从0开始 ?
        var pageSize = page.size; // 页长, 默认每页10条
        $.ajax({
            url: link + "/order/biddingRecords",
            type: "GET",
            data: {
                pageNumber: pageNum,
                pageSize: pageSize,
                auctionId: productId,
                orderBy: 'bidding_time',
                orderMode: 'DESC',
            },
            dataType: "Json",
            success: function (res) {
                console.log(res);
                var curPageData = res.data; // 接口返回的当前页数据列表
                var totalSize = res.count; // 接口返回的总数据量(比如列表有26个数据,每页10条,共3页; 则totalSize值为26)
                mescroll.endSuccess(curPageData.length);
                handler({
                    res: res, fun1: function () {
                        setListData(curPageData)
                    }
                })
            },
            error: function (e) {
                mescroll.endErr()
            }
        })
    }


    function setListData(curPageData) {
        console.log(curPageData);
        var str = "";
        for (var i = 0; i < curPageData.length; i++) {
            var pd = curPageData[i];
            str += '<ul><li>' +
                '<div class="head"><img src="img/head.png"></div>' +
                '<div class="use_box">' +
                '<p class="name">' + pd.userId.substring(0, 3) + '······' + pd.userId.substring(pd.userId.length - 4, pd.userId.length) + '</p>' +
                '<div class="evaluateMsg">' +
                '<p class="evaluateNum">评价 <span>' + pd.totalNumber + '</span></p>' +
                '<p class="general">好评率 <span>' + pd.praiseRate + '</span>%</p>' +
                '</div>' +
                '</div>' +
                '<p class="price">￥<span>' + pd.biddingAmount + '</span></p>' +
                '</li>' +
                '<p class="text">' + (pd.biddingMessage || '') + '</p>' +
                '<div class="time">' +
                '<span>' + pd.biddingTime + '</span>' +
                '</div>' +
                '</ul>'
        }
        $("#dataList").append(str);
        $("#dataList ul:nth-child(1) li").append('<div class="zhongbiao"></div>')
    }


    $.ajax({
        url: link + "/order/biddings/" + productId,
        type: "GET",
        data: {
            requestId: 'd79b9efa995f',
            timestamp: new Date().getTime(),
        },
        dataType: "Json",
        success: function (res) {
            console.log(res);
            handler({
                res: res, fun1: function () {
                    var pd = res.data;
                    var imgSrc = 'img/img.png';
                    if (pd.images) {
                        var imgArr = pd.images.split(';')[0].split(".");
                        imgSrc = link + imgArr[0] + '.thumbnail.' + imgArr[1]
                    }


                    // var  imgSrc = pd.images ? (link+pd.images.split(';')[0]) : 'img/img.png';
                    $(".basicMsg .img img").attr("src", imgSrc);
                    $(".basicMsg .txt_box .name").text(pd.title);
                    var str = "";
                    /*if(pd.introduce.length > 45){
                        str = pd.introduce.substring(0,40)+"..."
                    }else{
                        str = pd.introduce
                    }*/
//		        			$(".basicMsg .txt_box .text").html(pd.introduce.substring(0,20)+'...');

                    var timer6 = new Date().getTime();
                    var timer5 = pd.endTimestamp - timer6;
                    countDown(timer5);

                    $(".basicMsg .peonumber span").text(pd.peopleNumber);
                    $(".basicMsg .frequency span").text(pd.biddingNumber);
                }
            })
        },
        error: function (e) {
            console.log(e)
        }
    })
</script>
</body>
</html>